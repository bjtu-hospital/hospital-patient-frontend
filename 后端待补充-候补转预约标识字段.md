# åç«¯å¾…è¡¥å……ï¼šå€™è¡¥è½¬é¢„çº¦æ ‡è¯†å­—æ®µ

## é—®é¢˜æè¿°
å‰ç«¯å·²ç»å®ç°äº†å€™è¡¥è½¬é¢„çº¦è®¢å•çš„ç‰¹æ®Šæ˜¾ç¤ºï¼ˆæ˜¾ç¤º"å€™è¡¥æˆåŠŸ"æ ‡ç­¾å’Œ"å»æ”¯ä»˜"æŒ‰é’®ï¼‰ï¼Œä½†åç«¯è¿”å›çš„é¢„çº¦æ•°æ®ä¸­**ç¼ºå°‘æ ‡è¯†å­—æ®µ**ï¼Œå¯¼è‡´æ— æ³•è¯†åˆ«å“ªäº›è®¢å•æ˜¯ä»å€™è¡¥è½¬æ¥çš„ã€‚

## å½“å‰åç«¯è¿”å›çš„æ•°æ®ï¼ˆç¼ºå°‘æ ‡è¯†ï¼‰
```json
{
    "id": 642,
    "orderNo": "2025120980879969",
    "hospitalId": 5,
    "hospitalName": "æµ·æ·€åŒ—éƒ¨é™¢åŒº",
    "departmentId": 19,
    "departmentName": "éª¨ç§‘",
    "doctorName": "åˆå æ³½",
    "doctorTitle": "ä¸»ä»»åŒ»å¸ˆ",
    "scheduleId": 12963,
    "appointmentDate": "2025-12-12",
    "appointmentTime": "ä¸Šåˆ",
    "patientName": "å‘¨é”¦æ³½",
    "patientId": 155,
    "queueNumber": null,
    "price": 100.0,
    "status": "pending",
    "paymentStatus": "pending",
    "canCancel": true,
    "canReschedule": true,
    "createdAt": "2025-12-09 15:06:51"
}
```

## éœ€è¦åç«¯æ·»åŠ çš„å­—æ®µ

### æ–¹æ¡ˆä¸€ï¼šæ·»åŠ  `sourceType` å­—æ®µï¼ˆæ¨èï¼‰
```json
{
    "id": 642,
    "orderNo": "2025120980879969",
    // ... å…¶ä»–å­—æ®µä¿æŒä¸å˜ ...
    "status": "pending",
    "paymentStatus": "pending",
    
    // âœ… æ–°å¢å­—æ®µ
    "sourceType": "waitlist",           // é¢„çº¦æ¥æº: "normal"(æ™®é€šé¢„çº¦) æˆ– "waitlist"(å€™è¡¥è½¬é¢„çº¦)
    "sourceWaitlistId": 123,            // å…³è”çš„å€™è¡¥è®°å½•IDï¼ˆå¯é€‰ï¼Œä¾¿äºè¿½æº¯ï¼‰
    
    "canCancel": true,
    "canReschedule": true,
    "createdAt": "2025-12-09 15:06:51"
}
```

### æ–¹æ¡ˆäºŒï¼šæ·»åŠ å¸ƒå°”æ ‡å¿— `fromWaitlist`ï¼ˆå¤‡é€‰ï¼‰
```json
{
    "id": 642,
    // ... å…¶ä»–å­—æ®µ ...
    
    // âœ… æ–°å¢å­—æ®µ
    "fromWaitlist": true,               // æ˜¯å¦æ¥è‡ªå€™è¡¥è½¬é¢„çº¦
    "waitlistId": 123,                  // åŸå€™è¡¥è®°å½•IDï¼ˆå¯é€‰ï¼‰
    
    "status": "pending",
    "paymentStatus": "pending"
}
```

## åç«¯å®ç°å»ºè®®

### 1. åœ¨ Appointment è¡¨ä¸­æ·»åŠ å­—æ®µ
```sql
ALTER TABLE appointments 
ADD COLUMN source_type VARCHAR(20) DEFAULT 'normal' COMMENT 'é¢„çº¦æ¥æº: normal/waitlist',
ADD COLUMN source_waitlist_id INT COMMENT 'å…³è”çš„å€™è¡¥è®°å½•ID';
```

### 2. å€™è¡¥è½¬é¢„çº¦æ—¶è®¾ç½®å­—æ®µ
åœ¨å€™è¡¥è½¬é¢„çº¦çš„æ¥å£ `POST /patient/waitlist/{waitlistId}/convert` ä¸­ï¼š

```python
# ä¼ªä»£ç ç¤ºä¾‹
def convert_waitlist_to_appointment(waitlist_id):
    # åˆ›å»ºé¢„çº¦è®°å½•
    appointment = Appointment(
        # ... å…¶ä»–å­—æ®µ ...
        source_type="waitlist",           # ğŸ”§ æ ‡è®°ä¸ºå€™è¡¥è½¬é¢„çº¦
        source_waitlist_id=waitlist_id,   # ğŸ”§ è®°å½•å€™è¡¥ID
        status="pending",
        payment_status="pending"
    )
    db.save(appointment)
    
    # æ›´æ–°å€™è¡¥çŠ¶æ€
    waitlist.status = "success"
    waitlist.appointment_id = appointment.id
    db.save(waitlist)
    
    return appointment
```

### 3. åœ¨ GET /patient/appointments æ¥å£è¿”å›è¿™äº›å­—æ®µ
ç¡®ä¿åœ¨æŸ¥è¯¢é¢„çº¦åˆ—è¡¨æ—¶ï¼Œè¿”å› `sourceType` å’Œ `sourceWaitlistId` å­—æ®µã€‚

## å‰ç«¯å¦‚ä½•ä½¿ç”¨è¿™äº›å­—æ®µ

### AppointmentCard ç»„ä»¶è¯†åˆ«é€»è¾‘
```javascript
// src/components/AppointmentCard.vue
const isFromWaitlist = computed(() => {
  // æ–¹æ¡ˆä¸€ï¼šé€šè¿‡ sourceType åˆ¤æ–­
  return props.appointment.sourceType === 'waitlist'
  
  // æ–¹æ¡ˆäºŒï¼šé€šè¿‡ fromWaitlist åˆ¤æ–­
  // return props.appointment.fromWaitlist === true
})

// æ˜¾ç¤º"å€™è¡¥æˆåŠŸ"æ ‡ç­¾
<view v-if="isFromWaitlist" class="status-badge status-waitlist-success">
  <text class="status-text">âœ… å€™è¡¥æˆåŠŸ</text>
</view>

// æ˜¾ç¤º"å»æ”¯ä»˜"æŒ‰é’®
const showPay = computed(() => {
  return isFromWaitlist.value && 
         props.appointment.paymentStatus === 'pending'
})
```

## å½±å“èŒƒå›´
- **æ¥å£**: `GET /patient/appointments` (è·å–æˆ‘çš„é¢„çº¦åˆ—è¡¨)
- **æ•°æ®åº“**: `appointments` è¡¨
- **åç«¯é€»è¾‘**: å€™è¡¥è½¬é¢„çº¦æ¥å£ `POST /patient/waitlist/{waitlistId}/convert`

## ä¼˜å…ˆçº§
ğŸ”´ **é«˜ä¼˜å…ˆçº§** - å‰ç«¯åŠŸèƒ½å·²å®Œæˆï¼Œç­‰å¾…åç«¯å­—æ®µæ”¯æŒ

## æµ‹è¯•æ–¹æ³•
1. ç”¨æˆ·Aé¢„çº¦æ»¡æŸä¸ªå·æº
2. ç”¨æˆ·BåŠ å…¥å€™è¡¥
3. ç”¨æˆ·Aå–æ¶ˆé¢„çº¦
4. åç«¯è‡ªåŠ¨å°†ç”¨æˆ·Bçš„å€™è¡¥è½¬ä¸ºé¢„çº¦
5. ç”¨æˆ·Båœ¨"æˆ‘çš„é¢„çº¦"é¡µé¢æŸ¥çœ‹ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - âœ… è®¢å•æ˜¾ç¤º"å€™è¡¥æˆåŠŸ"æ ‡ç­¾ï¼ˆç»¿è‰²æ¸å˜ï¼‰
   - âœ… æœ‰"å»æ”¯ä»˜"æŒ‰é’®ï¼ˆç»¿è‰²æ¸å˜ï¼‰
   - âœ… ç‚¹å‡»"å»æ”¯ä»˜"è·³è½¬åˆ°æ”¯ä»˜é¡µé¢

## è”ç³»å‰ç«¯
å®Œæˆåè¯·é€šçŸ¥å‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬ä¼šç§»é™¤ä¸´æ—¶è°ƒè¯•ä»£ç å¹¶éªŒè¯åŠŸèƒ½ã€‚
