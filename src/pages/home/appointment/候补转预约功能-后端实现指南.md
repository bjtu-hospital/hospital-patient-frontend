# ğŸ”„ å€™è¡¥è½¬é¢„çº¦åŠŸèƒ½ - åç«¯å®ç°æŒ‡å—

## ğŸ“‹ æ–‡æ¡£ç›®å½•

1. [æ ¸å¿ƒä¸šåŠ¡æµç¨‹](#æ ¸å¿ƒä¸šåŠ¡æµç¨‹)
2. [æ•°æ®ç»“æ„å®šä¹‰](#æ•°æ®ç»“æ„å®šä¹‰)
3. [æ‰€éœ€APIæ¥å£](#æ‰€éœ€apiæ¥å£)
4. [å®šæ—¶ä»»åŠ¡è®¾è®¡](#å®šæ—¶ä»»åŠ¡è®¾è®¡)
5. [å‰ç«¯å…³è”ä»£ç ](#å‰ç«¯å…³è”ä»£ç )
6. [å®ç°æ­¥éª¤](#å®ç°æ­¥éª¤)
7. [æµ‹è¯•åœºæ™¯](#æµ‹è¯•åœºæ™¯)

---

## æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ğŸ¯ å€™è¡¥è½¬é¢„çº¦çš„å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»å€™è¡¥
    â†“
[confirm-waitlist.vue] è°ƒç”¨ createWaitlist()
    â†“
[appointment.js] POST /patient/waitlist
    â†“
åç«¯ä¿å­˜å€™è¡¥è®°å½• (status='waiting')
    â†“
æ˜¾ç¤ºå€™è¡¥æˆåŠŸé¡µé¢ [waitlist-success.vue]
    â†“
ç­‰å¾…è½¬é¢„çº¦çš„è§¦å‘æ¡ä»¶ï¼š
    â”œâ”€ 1ï¸âƒ£ ç”¨æˆ·Açš„é¢„çº¦è¢«å–æ¶ˆ â†’ å·æºé‡Šæ”¾
    â”œâ”€ 2ï¸âƒ£ åŒ»ç”Ÿä¸´æ—¶åŠ å· â†’ å·æºå¢åŠ 
    â””â”€ 3ï¸âƒ£ å°±è¯Šå‰ä¸€å¤©18:00 â†’ è‡ªåŠ¨è¿‡æœŸ
    â†“
ã€åç«¯æ ¸å¿ƒå¤„ç†ã€‘
â”‚
â”œâ”€ åç«¯æ£€æŸ¥åˆ°æœ‰å·æºé‡Šæ”¾
â”œâ”€ æŸ¥è¯¢è¯¥æ’ç­çš„å€™è¡¥é˜Ÿåˆ—ï¼ˆæŒ‰ä½ç½®æ’åºï¼‰
â”œâ”€ ä¸ºå€™è¡¥ä½ç½®=1çš„ç”¨æˆ·åˆ›å»ºé¢„çº¦
â”œâ”€ æ›´æ–°å€™è¡¥çŠ¶æ€ä¸º 'success'
â”œâ”€ ä¿å­˜æ–°çš„ appointmentId
â””â”€ å‘é€é€šçŸ¥ç»™ç”¨æˆ·
    â†“
ç”¨æˆ·åˆ·æ–°"æˆ‘çš„å€™è¡¥"é¡µé¢ [waitlist.vue]
    â†“
æ˜¾ç¤º"âœ… å·²è½¬ä¸ºé¢„çº¦"çŠ¶æ€
    â†“
ç”¨æˆ·å¯åœ¨"æˆ‘çš„é¢„çº¦"[appointments.vue]ä¸­çœ‹åˆ°æ–°çš„é¢„çº¦å•
```

---

## æ•°æ®ç»“æ„å®šä¹‰

### 1ï¸âƒ£ å€™è¡¥è®°å½•è¡¨ (Waitlist)

#### **åˆ›å»ºæ—¶çš„æ•°æ®ç»“æ„**

```javascript
{
  // åŸºç¡€ä¿¡æ¯
  id: 'waitlist_001',                           // å€™è¡¥ID (ä¸»é”®)
  userId: 'user_123',                           // ç”¨æˆ·ID
  patientId: 'patient_001',                     // å°±è¯ŠäººID
  patientName: 'å¼ ä¸‰',                          // å°±è¯Šäººå§“å
  
  // æ’ç­ä¿¡æ¯
  scheduleId: 'schedule_001',                   // æ’ç­ID
  hospitalId: 'hospital_001',                   // åŒ»é™¢ID
  hospitalName: 'åŒ—äº¬äº¤é€šå¤§å­¦æ ¡åŒ»é™¢ï¼ˆæœ¬éƒ¨ï¼‰',
  departmentId: 'dept_005',                     // ç§‘å®¤ID
  departmentName: 'å¿ƒå†…ç§‘é—¨è¯Š',
  doctorId: 'doctor_001',                       // åŒ»ç”ŸID
  doctorName: 'åˆ˜é–',
  doctorTitle: 'ä¸»æ²»åŒ»å¸ˆ',
  
  // æ—¶é—´å’Œä»·æ ¼
  appointmentDate: '2024-11-13',                // å°±è¯Šæ—¥æœŸ
  appointmentTime: 'ä¸Šåˆ 08:00-12:00',
  period: 'ä¸Šåˆ',                               // ä¸Šåˆ/ä¸‹åˆ
  appointmentType: 'æ™®é€šé—¨è¯Š',                  // æ™®é€š/ä¸“å®¶/ç‰¹éœ€ç­‰
  price: 50,
  
  // å€™è¡¥ä¿¡æ¯
  position: 3,                                  // ã€å…³é”®ã€‘å€™è¡¥ä½ç½®ï¼ˆ1è¡¨ç¤ºé˜Ÿåˆ—æœ€å‰ï¼‰
  status: 'waiting',                            // ã€å…³é”®ã€‘status: waiting/success/expired/cancelled
  
  // è½¬é¢„çº¦åçš„æ•°æ®ï¼ˆstatus='success'æ—¶å¡«å……ï¼‰
  appointmentId: null,                          // ã€å…³é”®ã€‘è½¬æ¢åçš„é¢„çº¦IDï¼ˆå¾…è½¬é¢„çº¦æ—¶ä¸ºnullï¼‰
  
  // æ—¶é—´æ§åˆ¶
  expiryDate: '2024-11-12',                     // ã€å…³é”®ã€‘å€™è¡¥æˆªæ­¢æ—¥æœŸï¼ˆå°±è¯Šå‰ä¸€æ—¥ï¼‰
  expiryTime: '18:00:00',                       // ã€å…³é”®ã€‘å€™è¡¥æˆªæ­¢æ—¶é—´ï¼ˆå°±è¯Šå‰ä¸€æ—¥18ç‚¹ï¼‰
  createdAt: '2024-11-11 10:00:00',
  updatedAt: '2024-11-11 10:00:00',
  
  // è½¬é¢„çº¦æ—¶é—´æˆ³
  convertedAt: null                             // ã€å…³é”®ã€‘è½¬ä¸ºé¢„çº¦çš„æ—¶é—´
}
```

#### **è½¬é¢„çº¦åçš„æ•°æ®ç»“æ„ï¼ˆstatus='success'ï¼‰**

```javascript
{
  // ... ä¿æŒåŸæœ‰å­—æ®µä¸å˜ ...
  
  // ã€å·²å˜æ›´ã€‘
  status: 'success',                            // âœ… è½¬ä¸ºé¢„çº¦çŠ¶æ€
  appointmentId: 'appointment_12345',           // âœ… æ–°çš„é¢„çº¦ID
  position: 1,                                  // âœ… ç¡®è®¤ä½ç½®
  convertedAt: '2024-11-11 14:30:00',          // âœ… è½¬é¢„çº¦æ—¶é—´æˆ³
  
  // ã€æ–°å¢ã€‘é¢„çº¦ç›¸å…³ä¿¡æ¯
  orderNo: '2024111400001',                     // é¢„çº¦å•å·
  queueNumber: '5',                             // å–å·å·ç 
  isPaid: false,                                // æ˜¯å¦å·²æ”¯ä»˜
  payDeadline: '2024-11-13 18:00:00'            // æ”¯ä»˜æˆªæ­¢æ—¶é—´
}
```

---

### 2ï¸âƒ£ é¢„çº¦è®°å½•è¡¨ (Appointment) - æ‰©å±•å­—æ®µ

å½“å€™è¡¥è½¬é¢„çº¦æ—¶ï¼Œéœ€è¦æ–°å¢è¿™äº›å­—æ®µæ¥è¿½è¸ªæºå¤´ï¼š

```javascript
{
  // ã€åŸæœ‰å­—æ®µã€‘
  id: 'appointment_12345',
  orderNo: '2024111400001',
  userId: 'user_123',
  patientId: 'patient_001',
  patientName: 'å¼ ä¸‰',
  hospitalId: 'hospital_001',
  hospitalName: 'åŒ—äº¬äº¤é€šå¤§å­¦æ ¡åŒ»é™¢ï¼ˆæœ¬éƒ¨ï¼‰',
  departmentId: 'dept_005',
  departmentName: 'å¿ƒå†…ç§‘é—¨è¯Š',
  doctorId: 'doctor_001',
  doctorName: 'åˆ˜é–',
  appointmentDate: '2024-11-13',
  appointmentTime: 'ä¸Šåˆ 08:00-12:00',
  price: 50,
  status: 'pending',
  queueNumber: '5',
  
  // ã€æ–°å¢ï¼šå€™è¡¥æ¥æºè¿½è¸ªã€‘
  sourceType: 'waitlist',                       // ã€å…³é”®ã€‘normal(æ™®é€šé¢„çº¦) / waitlist(å€™è¡¥è½¬é¢„çº¦)
  sourceWaitlistId: 'waitlist_001',             // ã€å…³é”®ã€‘å…³è”çš„å€™è¡¥IDï¼ˆå¦‚æœæ˜¯ä»å€™è¡¥è½¬è¿‡æ¥ï¼‰
  
  // ã€æ”¯ä»˜ç›¸å…³ã€‘
  isPaid: false,
  payAmount: 50,
  payDeadline: '2024-11-13 18:00:00',           // æ”¯ä»˜æˆªæ­¢æ—¶é—´
  
  createdAt: '2024-11-11 14:30:00',
  updatedAt: '2024-11-11 14:30:00'
}
```

---

### 3ï¸âƒ£ æ’ç­è¡¨ (Schedule) - å·æºç®¡ç†

```javascript
{
  id: 'schedule_001',
  doctorId: 'doctor_001',
  doctorName: 'åˆ˜é–',
  doctorTitle: 'ä¸»æ²»åŒ»å¸ˆ',
  departmentId: 'dept_005',
  departmentName: 'å¿ƒå†…ç§‘é—¨è¯Š',
  hospitalId: 'hospital_001',
  
  date: '2024-11-13',
  period: 'ä¸Šåˆ',
  startTime: '08:00',
  endTime: '12:00',
  appointmentType: 'æ™®é€šé—¨è¯Š',
  price: 50,
  
  // ã€å…³é”®ï¼šå·æºç®¡ç†ã€‘
  totalSlots: 25,                               // æ€»å·æºæ•°
  availableSlots: 5,                            // ğŸ”§ å¯ç”¨å·æºæ•°ï¼ˆå½“å–æ¶ˆé¢„çº¦æ—¶å¢åŠ ï¼‰
  bookedSlots: 20,                              // å·²é¢„çº¦å·æºæ•°
  waitlistCount: 3,                             // è¯¥æ’ç­çš„å€™è¡¥äººæ•°
  
  createdAt: '2024-11-10 08:00:00',
  updatedAt: '2024-11-11 14:30:00'
}
```

---

## æ‰€éœ€APIæ¥å£

### 1ï¸âƒ£ åˆ›å»ºå€™è¡¥ - å‰ç«¯å·²å®ç°

**å‰ç«¯è°ƒç”¨æ–‡ä»¶**: `src/api/appointment.js` â†’ `createWaitlist()`

```javascript
// å‰ç«¯ä»£ç ä½ç½®
// src/pages/home/appointment/confirm-waitlist.vue (Line 120-150)
const confirmWaitlist = async () => {
  const result = await createWaitlist({
    scheduleId: schedule.value.id,
    patientId: selectedPatient.value.id
  })
  // result: { waitlistId, position }
}
```

**API å®šä¹‰**

```http
POST /patient/waitlist
Content-Type: application/json
Authorization: Bearer {token}

è¯·æ±‚ä½“ï¼š
{
  "scheduleId": "schedule_001",
  "patientId": "patient_001"
}

å“åº”ï¼ˆæˆåŠŸï¼‰:
{
  "code": 0,
  "message": "å·²åŠ å…¥å€™è¡¥é˜Ÿåˆ—",
  "data": {
    "waitlistId": "waitlist_001",
    "position": 3,              // ã€å…³é”®ã€‘å½“å‰ä½ç½®
    "expiryDate": "2024-11-12",
    "expiryTime": "18:00:00"
  }
}

å“åº”ï¼ˆå¤±è´¥ï¼‰:
{
  "code": 400,
  "message": "åŒä¸€ç§‘å®¤åŒä¸€ç±»å‹çš„å€™è¡¥ä¸èƒ½é‡å¤æäº¤"
}
```

**åç«¯å®ç°è¦ç‚¹**

```javascript
@PostMapping("/patient/waitlist")
public Result createWaitlist(@RequestBody CreateWaitlistRequest req) {
  // 1. éªŒè¯è¯¥ç”¨æˆ·æ˜¯å¦å·²æœ‰ç›¸åŒç§‘å®¤ç±»å‹çš„å€™è¡¥
  if (isDuplicateWaitlist(req.userId, req.scheduleId)) {
    throw new BusinessException("åŒä¸€ç§‘å®¤åŒä¸€ç±»å‹çš„å€™è¡¥ä¸èƒ½é‡å¤æäº¤");
  }
  
  // 2. éªŒè¯è¯¥ç”¨æˆ·çš„å€™è¡¥æ€»æ•°æ˜¯å¦è¶…è¿‡3ä¸ª
  if (userWaitlistCount(req.userId) >= 3) {
    throw new BusinessException("åŒæ—¶æœ€å¤šå¯æäº¤3ä¸ªå€™è¡¥è®¢å•");
  }
  
  // 3. è®¡ç®—å½“å‰æ’ç­çš„å€™è¡¥ä½ç½®
  int position = countExistingWaitlist(req.scheduleId) + 1;
  
  // 4. è®¡ç®—è¿‡æœŸæ—¶é—´ï¼ˆå°±è¯Šå‰ä¸€æ—¥18:00ï¼‰
  LocalDateTime expiryDateTime = getExpiryDateTime(schedule.appointmentDate);
  
  // 5. ä¿å­˜å€™è¡¥è®°å½•åˆ°æ•°æ®åº“
  Waitlist waitlist = new Waitlist();
  waitlist.setScheduleId(req.scheduleId);
  waitlist.setPatientId(req.patientId);
  waitlist.setPosition(position);
  waitlist.setStatus("waiting");
  waitlist.setExpiryDate(expiryDateTime.toLocalDate());
  waitlist.setExpiryTime(expiryDateTime.toLocalTime());
  waitlistRepository.save(waitlist);
  
  return Result.success(new CreateWaitlistResponse(
    waitlist.getId(),
    position,
    expiryDateTime.toLocalDate().toString(),
    expiryDateTime.toLocalTime().toString()
  ));
}
```

---

### 2ï¸âƒ£ ã€æ ¸å¿ƒã€‘å–æ¶ˆé¢„çº¦ â†’ è§¦å‘å€™è¡¥è½¬é¢„çº¦

**å‰ç«¯è°ƒç”¨ä½ç½®**

```
src/pages/profile/appointments.vue (Line 100-130)
  â†“ cancelAppointment()
  â†“ cancelAppointmentApi(appointment.id)
  â†“ src/api/appointment.js â†’ cancelAppointment()
```

**API å®šä¹‰**

```http
PUT /patient/appointments/{appointmentId}/cancel
Content-Type: application/json
Authorization: Bearer {token}

å“åº”:
{
  "code": 0,
  "message": "é¢„çº¦å·²å–æ¶ˆ",
  "data": {
    "appointmentId": "appointment_001",
    "status": "cancelled",
    "refundAmount": 50,
    "waitlistConverted": {
      "converted": true,              // ã€å…³é”®ã€‘æ˜¯å¦æœ‰å€™è¡¥è¢«è½¬é¢„çº¦
      "waitlistId": "waitlist_001",
      "newAppointmentId": "appt_12345"
    }
  }
}
```

**åç«¯å®ç°è¦ç‚¹ï¼ˆæœ€å…³é”®çš„åŠŸèƒ½ï¼ï¼‰**

```javascript
@PutMapping("/patient/appointments/{appointmentId}/cancel")
@Transactional  // ã€å…³é”®ã€‘ä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§
public Result cancelAppointment(@PathVariable String appointmentId) {
  // 1. æŸ¥æ‰¾é¢„çº¦
  Appointment appointment = appointmentRepository.findById(appointmentId)
    .orElseThrow(() -> new BusinessException("é¢„çº¦ä¸å­˜åœ¨"));
  
  // 2. éªŒè¯å¯ä»¥å–æ¶ˆï¼ˆåªæœ‰å¾…å°±è¯ŠçŠ¶æ€æ‰èƒ½å–æ¶ˆï¼‰
  if (!appointment.getStatus().equals("pending")) {
    throw new BusinessException("è¯¥é¢„çº¦æ— æ³•å–æ¶ˆ");
  }
  
  // 3. æ›´æ–°é¢„çº¦çŠ¶æ€ä¸ºå·²å–æ¶ˆ
  appointment.setStatus("cancelled");
  appointmentRepository.save(appointment);
  
  // 4. ã€å…³é”®ã€‘å¢åŠ æ’ç­çš„å¯ç”¨å·æº
  Schedule schedule = scheduleRepository.findById(appointment.getScheduleId())
    .orElseThrow();
  schedule.setAvailableSlots(schedule.getAvailableSlots() + 1);
  scheduleRepository.save(schedule);
  
  // 5. ã€æœ€å…³é”®ã€‘æ£€æŸ¥æ˜¯å¦æœ‰å€™è¡¥å¯ä»¥è½¬é¢„çº¦
  WaitlistConvertResult convertResult = convertWaitlistToAppointment(
    appointment.getScheduleId()
  );
  
  // 6. è¿”å›å–æ¶ˆç»“æœï¼ŒåŒ…å«æ˜¯å¦è½¬é¢„çº¦çš„ä¿¡æ¯
  return Result.success(new CancelAppointmentResponse(
    appointmentId,
    "cancelled",
    50,  // é€€æ¬¾é‡‘é¢
    convertResult
  ));
}

/**
 * ã€æ ¸å¿ƒé€»è¾‘ã€‘å°†å€™è¡¥è½¬ä¸ºé¢„çº¦
 */
private WaitlistConvertResult convertWaitlistToAppointment(String scheduleId) {
  // 1. æŸ¥æ‰¾è¯¥æ’ç­ position=1 çš„å€™è¡¥è®°å½•
  Waitlist topWaitlist = waitlistRepository
    .findTopByScheduleIdAndStatusOrderByPositionAsc(scheduleId, "waiting")
    .orElse(null);
  
  if (topWaitlist == null) {
    // æ²¡æœ‰å€™è¡¥ï¼Œç›´æ¥è¿”å›
    return new WaitlistConvertResult(false, null, null);
  }
  
  // 2. æ£€æŸ¥å€™è¡¥æ˜¯å¦å·²è¿‡æœŸ
  LocalDateTime now = LocalDateTime.now();
  LocalDateTime expiryDateTime = LocalDateTime.of(
    topWaitlist.getExpiryDate(),
    topWaitlist.getExpiryTime()
  );
  
  if (now.isAfter(expiryDateTime)) {
    // å€™è¡¥å·²è¿‡æœŸï¼Œæ›´æ–°çŠ¶æ€
    topWaitlist.setStatus("expired");
    waitlistRepository.save(topWaitlist);
    return new WaitlistConvertResult(false, topWaitlist.getId(), null);
  }
  
  // 3. åˆ›å»ºæ–°çš„é¢„çº¦
  Appointment newAppointment = new Appointment();
  newAppointment.setScheduleId(scheduleId);
  newAppointment.setPatientId(topWaitlist.getPatientId());
  newAppointment.setPatientName(topWaitlist.getPatientName());
  newAppointment.setHospitalId(topWaitlist.getHospitalId());
  newAppointment.setDepartmentId(topWaitlist.getDepartmentId());
  newAppointment.setDoctorId(topWaitlist.getDoctorId());
  newAppointment.setAppointmentDate(topWaitlist.getAppointmentDate());
  newAppointment.setAppointmentType(topWaitlist.getAppointmentType());
  newAppointment.setPrice(topWaitlist.getPrice());
  newAppointment.setStatus("pending");              // æ–°é¢„çº¦é»˜è®¤å¾…æ”¯ä»˜
  newAppointment.setQueueNumber(generateQueueNumber());
  newAppointment.setSourceType("waitlist");         // ã€å…³é”®ã€‘æ ‡è®°æºç±»å‹
  newAppointment.setSourceWaitlistId(topWaitlist.getId());  // ã€å…³é”®ã€‘å…³è”å€™è¡¥ID
  newAppointment.setCreatedAt(LocalDateTime.now());
  
  Appointment savedAppointment = appointmentRepository.save(newAppointment);
  
  // 4. ã€å…³é”®ã€‘æ›´æ–°å€™è¡¥çŠ¶æ€ä¸ºæˆåŠŸï¼Œè®°å½•æ–°çš„é¢„çº¦ID
  topWaitlist.setStatus("success");
  topWaitlist.setAppointmentId(savedAppointment.getId());
  topWaitlist.setPosition(1);  // ä½ç½®ç¡®è®¤
  topWaitlist.setConvertedAt(LocalDateTime.now());
  waitlistRepository.save(topWaitlist);
  
  // 5. ã€å¯é€‰ã€‘å‘é€é€šçŸ¥ç»™ç”¨æˆ·
  sendNotification(topWaitlist.getUserId(), 
    "æ‚¨çš„å€™è¡¥å·²æˆåŠŸè½¬ä¸ºé¢„çº¦ï¼Œè¯·åŠæ—¶æ”¯ä»˜ï¼");
  
  return new WaitlistConvertResult(
    true,
    topWaitlist.getId(),
    savedAppointment.getId()
  );
}
```

---

### 3ï¸âƒ£ è·å–å€™è¡¥åˆ—è¡¨ - å‰ç«¯å·²å®ç°

**å‰ç«¯è°ƒç”¨ä½ç½®**

```
src/pages/profile/waitlist.vue (Line 80-95)
  â†“ loadWaitlist()
  â†“ getMyWaitlist()
  â†“ src/api/appointment.js
```

**API å®šä¹‰**

```http
GET /patient/waitlist
Content-Type: application/json
Authorization: Bearer {token}

æŸ¥è¯¢å‚æ•°ï¼š
  status: 'all' | 'waiting' | 'success' | 'expired' | 'cancelled'
  page: 1
  pageSize: 10

å“åº”:
{
  "code": 0,
  "message": "success",
  "data": {
    "total": 5,
    "list": [
      {
        "id": "waitlist_001",
        "patientName": "å¼ ä¸‰",
        "hospitalName": "åŒ—äº¬äº¤é€šå¤§å­¦æ ¡åŒ»é™¢ï¼ˆæœ¬éƒ¨ï¼‰",
        "departmentName": "å¿ƒå†…ç§‘é—¨è¯Š",
        "appointmentDate": "2024-11-13",
        "appointmentTime": "ä¸Šåˆ 08:00-12:00",
        "position": 3,
        "status": "waiting",              // ã€å…³é”®ã€‘ç”¨æˆ·é€šè¿‡æ­¤å­—æ®µåˆ¤æ–­çŠ¶æ€
        "appointmentId": null,
        "createdAt": "2024-11-11 10:00:00"
      },
      {
        "id": "waitlist_002",
        "patientName": "æå››",
        "hospitalName": "åŒ—äº¬äº¤é€šå¤§å­¦æ ¡åŒ»é™¢ï¼ˆä¸œæ ¡åŒºï¼‰",
        "departmentName": "å‘¼å¸å†…ç§‘é—¨è¯Š",
        "appointmentDate": "2024-11-15",
        "appointmentTime": "ä¸‹åˆ 14:00-17:00",
        "position": 1,
        "status": "success",              // âœ… å·²è½¬ä¸ºé¢„çº¦
        "appointmentId": "appointment_12345",  // æ–°é¢„çº¦ID
        "createdAt": "2024-11-10 15:30:00"
      }
    ]
  }
}
```

**åç«¯å®ç°è¦ç‚¹**

```javascript
@GetMapping("/patient/waitlist")
public Result getMyWaitlist(@RequestParam(required = false) String status,
                            @RequestParam(defaultValue = "1") int page,
                            @RequestParam(defaultValue = "10") int pageSize) {
  // 1. è·å–å½“å‰ç”¨æˆ·ID
  String userId = SecurityContextHolder.getContext().getAuthentication().getName();
  
  // 2. æ„å»ºæŸ¥è¯¢æ¡ä»¶
  Specification<Waitlist> spec = (root, query, cb) -> {
    List<Predicate> predicates = new ArrayList<>();
    predicates.add(cb.equal(root.get("userId"), userId));
    
    if (status != null && !status.equals("all")) {
      predicates.add(cb.equal(root.get("status"), status));
    }
    
    return cb.and(predicates.toArray(new Predicate[0]));
  };
  
  // 3. åˆ†é¡µæ’åºï¼šæŒ‰åˆ›å»ºæ—¶é—´å€’åº
  Pageable pageable = PageRequest.of(
    page - 1,
    pageSize,
    Sort.by("createdAt").descending()
  );
  
  // 4. æŸ¥è¯¢æ•°æ®åº“
  Page<Waitlist> result = waitlistRepository.findAll(spec, pageable);
  
  // 5. è½¬æ¢ä¸ºDTOå¹¶è¿”å›
  return Result.success(new PageResponse(
    result.getTotalElements(),
    result.getContent().stream()
      .map(this::convertToDTO)
      .collect(Collectors.toList())
  ));
}
```

---

### 4ï¸âƒ£ å–æ¶ˆå€™è¡¥ - å‰ç«¯å·²å®ç°

**å‰ç«¯è°ƒç”¨ä½ç½®**

```
src/pages/profile/waitlist.vue (Line 110-130)
  â†“ handleCancel(waitlistId)
  â†“ cancelWaitlist()
  â†“ src/api/appointment.js
```

**API å®šä¹‰**

```http
DELETE /patient/waitlist/{waitlistId}
Content-Type: application/json
Authorization: Bearer {token}

å“åº”:
{
  "code": 0,
  "message": "å€™è¡¥å·²å–æ¶ˆ",
  "data": {
    "waitlistId": "waitlist_001",
    "status": "cancelled"
  }
}
```

**åç«¯å®ç°è¦ç‚¹**

```javascript
@DeleteMapping("/patient/waitlist/{waitlistId}")
public Result cancelWaitlist(@PathVariable String waitlistId) {
  // 1. æŸ¥æ‰¾å€™è¡¥è®°å½•
  Waitlist waitlist = waitlistRepository.findById(waitlistId)
    .orElseThrow(() -> new BusinessException("å€™è¡¥è®°å½•ä¸å­˜åœ¨"));
  
  // 2. éªŒè¯åªæœ‰ waiting çŠ¶æ€æ‰èƒ½å–æ¶ˆ
  if (!waitlist.getStatus().equals("waiting")) {
    throw new BusinessException("è¯¥å€™è¡¥æ— æ³•å–æ¶ˆ");
  }
  
  // 3. æ›´æ–°çŠ¶æ€ä¸ºå·²å–æ¶ˆ
  waitlist.setStatus("cancelled");
  waitlist.setUpdatedAt(LocalDateTime.now());
  waitlistRepository.save(waitlist);
  
  // 4. ã€å…³é”®ã€‘é‡æ–°æ’ä½å€™è¡¥é˜Ÿåˆ—ä¸­çš„å…¶ä»–å€™è¡¥
  reorderWaitlist(waitlist.getScheduleId());
  
  return Result.success(new CancelWaitlistResponse(waitlistId, "cancelled"));
}

/**
 * é‡æ–°æ’åˆ—è¯¥æ’ç­çš„å€™è¡¥é˜Ÿåˆ—ä½ç½®
 */
private void reorderWaitlist(String scheduleId) {
  // æŸ¥è¯¢è¯¥æ’ç­æ‰€æœ‰ waiting çŠ¶æ€çš„å€™è¡¥ï¼ˆæŒ‰positionæ’åºï¼‰
  List<Waitlist> waitlists = waitlistRepository
    .findByScheduleIdAndStatusOrderByPosition(scheduleId, "waiting");
  
  // é‡æ–°åˆ†é…position
  for (int i = 0; i < waitlists.size(); i++) {
    waitlists.get(i).setPosition(i + 1);
  }
  
  waitlistRepository.saveAll(waitlists);
}
```

---

## å®šæ—¶ä»»åŠ¡è®¾è®¡

### 1ï¸âƒ£ å®šæ—¶ä»»åŠ¡ï¼šæ£€æŸ¥è¿‡æœŸçš„å€™è¡¥

**æ‰§è¡Œé¢‘ç‡**: æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆå»ºè®®åœ¨éé«˜å³°æ—¶æ®µï¼Œå¦‚ 00:30, 01:30 ç­‰ï¼‰

**ä»»åŠ¡é€»è¾‘**

```javascript
@Component
public class WaitlistExpireTask {
  
  @Scheduled(cron = "0 30 * * * ?")  // æ¯å°æ—¶çš„ç¬¬30åˆ†é’Ÿæ‰§è¡Œ
  @Transactional
  public void expireOverdueWaitlist() {
    System.out.println("ã€å®šæ—¶ä»»åŠ¡ã€‘å¼€å§‹æ£€æŸ¥è¿‡æœŸå€™è¡¥...");
    
    LocalDateTime now = LocalDateTime.now();
    
    // 1. æŸ¥è¯¢æ‰€æœ‰ status='waiting' çš„å€™è¡¥
    List<Waitlist> waitingList = waitlistRepository
      .findByStatus("waiting");
    
    // 2. éå†æ¯æ¡è®°å½•ï¼Œæ£€æŸ¥æ˜¯å¦å·²è¿‡æœŸ
    for (Waitlist waitlist : waitingList) {
      LocalDateTime expiryDateTime = LocalDateTime.of(
        waitlist.getExpiryDate(),
        waitlist.getExpiryTime()
      );
      
      // 3. å¦‚æœå½“å‰æ—¶é—´ > æˆªæ­¢æ—¶é—´ï¼Œæ ‡è®°ä¸ºè¿‡æœŸ
      if (now.isAfter(expiryDateTime)) {
        waitlist.setStatus("expired");
        waitlist.setUpdatedAt(now);
        waitlistRepository.save(waitlist);
        
        // ã€å¯é€‰ã€‘å‘é€é€šçŸ¥
        sendNotification(waitlist.getUserId(),
          "æ‚¨çš„å€™è¡¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°å€™è¡¥æˆ–é¢„çº¦");
        
        System.out.println("å€™è¡¥å·²è¿‡æœŸï¼š" + waitlist.getId());
      }
    }
    
    System.out.println("ã€å®šæ—¶ä»»åŠ¡ã€‘è¿‡æœŸå€™è¡¥æ£€æŸ¥å®Œæˆ");
  }
}
```

---

### 2ï¸âƒ£ å®šæ—¶ä»»åŠ¡ï¼šè‡ªåŠ¨è§¦å‘å€™è¡¥è½¬é¢„çº¦

**æ‰§è¡Œé¢‘ç‡**: æ¯30ç§’æ‰§è¡Œä¸€æ¬¡ï¼ˆæˆ–æ¯æ¬¡å–æ¶ˆé¢„çº¦åç«‹å³æ‰§è¡Œï¼‰

**ä»»åŠ¡é€»è¾‘**

```javascript
@Component
public class WaitlistConvertTask {
  
  @Scheduled(fixedDelay = 30000)  // æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
  @Transactional
  public void convertPendingWaitlist() {
    System.out.println("ã€å®šæ—¶ä»»åŠ¡ã€‘å¼€å§‹æ£€æŸ¥å¯è½¬æ¢çš„å€™è¡¥...");
    
    // 1. æŸ¥è¯¢æ‰€æœ‰æœ‰å¯ç”¨å·æºçš„æ’ç­
    List<Schedule> schedulesWithSlots = scheduleRepository
      .findByAvailableSlotsGreaterThan(0);
    
    // 2. å¯¹äºæ¯ä¸ªæœ‰å·æºçš„æ’ç­ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¾…è½¬çš„å€™è¡¥
    for (Schedule schedule : schedulesWithSlots) {
      Waitlist topWaitlist = waitlistRepository
        .findTopByScheduleIdAndStatusOrderByPositionAsc(
          schedule.getId(),
          "waiting"
        )
        .orElse(null);
      
      if (topWaitlist != null) {
        // 3. æ£€æŸ¥å€™è¡¥æ˜¯å¦è¿‡æœŸ
        LocalDateTime now = LocalDateTime.now();
        LocalDateTime expiryDateTime = LocalDateTime.of(
          topWaitlist.getExpiryDate(),
          topWaitlist.getExpiryTime()
        );
        
        if (now.isBefore(expiryDateTime)) {
          // 4. å€™è¡¥æœªè¿‡æœŸï¼Œå¯ä»¥è½¬é¢„çº¦
          convertWaitlistToAppointment(schedule.getId());
          System.out.println("å€™è¡¥å·²è‡ªåŠ¨è½¬ä¸ºé¢„çº¦ï¼š" + topWaitlist.getId());
        } else {
          // 5. å€™è¡¥å·²è¿‡æœŸï¼Œæ›´æ–°çŠ¶æ€
          topWaitlist.setStatus("expired");
          waitlistRepository.save(topWaitlist);
          System.out.println("å€™è¡¥å·²è‡ªåŠ¨è¿‡æœŸï¼š" + topWaitlist.getId());
        }
      }
    }
    
    System.out.println("ã€å®šæ—¶ä»»åŠ¡ã€‘å€™è¡¥è½¬æ¢æ£€æŸ¥å®Œæˆ");
  }
  
  private void convertWaitlistToAppointment(String scheduleId) {
    // ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„æ ¸å¿ƒé€»è¾‘
    // ... (è§å–æ¶ˆé¢„çº¦ä¸­çš„ convertWaitlistToAppointment æ–¹æ³•)
  }
}
```

---

## å‰ç«¯å…³è”ä»£ç 

### ğŸ“ æ‰€æœ‰ç›¸å…³çš„å‰ç«¯æ–‡ä»¶ä½ç½®

#### **1. å€™è¡¥åˆ›å»ºç›¸å…³**
```
ğŸ“‚ src/pages/home/appointment/
â”œâ”€â”€ confirm-waitlist.vue        â­ ç”¨æˆ·ç¡®è®¤å€™è¡¥ä¿¡æ¯çš„é¡µé¢
â”‚   â””â”€ æŒ‰é’®ï¼š"ç¡®è®¤å€™è¡¥" â†’ è°ƒç”¨ createWaitlist()
â”œâ”€â”€ waitlist-success.vue        â­ å€™è¡¥æˆåŠŸåçš„è¯¦æƒ…é¡µé¢
â”‚   â””â”€ æ˜¾ç¤º status å‚æ•°ï¼ˆwaiting/success/expired/cancelledï¼‰
â””â”€â”€ select-doctor.vue           â­ åŒ»ç”Ÿé€‰æ‹©é¡µé¢
    â””â”€ æŒ‰é’®ï¼š"åŠ å…¥å€™è¡¥" â†’ è·³è½¬åˆ° confirm-waitlist.vue
```

#### **2. å€™è¡¥ç®¡ç†ç›¸å…³**
```
ğŸ“‚ src/pages/profile/
â””â”€â”€ waitlist.vue               â­ æˆ‘çš„å€™è¡¥åˆ—è¡¨é¡µé¢
    â”œâ”€ åŠ è½½åˆ—è¡¨ï¼šgetMyWaitlist()
    â”œâ”€ æŸ¥çœ‹è¯¦æƒ…ï¼šviewDetail(item) â†’ è·³è½¬åˆ° waitlist-success.vue
    â”œâ”€ å–æ¶ˆå€™è¡¥ï¼šhandleCancel(waitlistId) â†’ è°ƒç”¨ cancelWaitlist()
    â””â”€ æ¸©é¦¨æç¤ºï¼šå€™è¡¥æˆåŠŸè®¢å•è¯·å‰å¾€"æˆ‘çš„é¢„çº¦"æŸ¥çœ‹
```

#### **3. é¢„çº¦ç›¸å…³ï¼ˆæ”¯æŒå€™è¡¥è½¬é¢„çº¦ï¼‰**
```
ğŸ“‚ src/pages/profile/
â””â”€â”€ appointments.vue           â­ æˆ‘çš„é¢„çº¦åˆ—è¡¨é¡µé¢
    â”œâ”€ æ˜¾ç¤ºæ‰€æœ‰é¢„çº¦ï¼ˆåŒ…æ‹¬ä»å€™è¡¥è½¬è¿‡æ¥çš„ï¼‰
    â”œâ”€ å–æ¶ˆé¢„çº¦ï¼šcancelAppointment() â†’ è§¦å‘åç«¯è½¬æ¢å€™è¡¥é€»è¾‘
    â””â”€ åˆ·æ–°æ—¶è‡ªåŠ¨åŠ è½½ï¼ˆonShow é’©å­ï¼‰

ğŸ“‚ src/pages/home/appointment/
â””â”€â”€ success.vue                â­ é¢„çº¦æˆåŠŸé¡µé¢
    â””â”€ æ”¯ä»˜æˆåŠŸåè·³è½¬åˆ° appointments.vue æŸ¥çœ‹
```

#### **4. API æ¥å£æ–‡ä»¶**
```
ğŸ“‚ src/api/
â””â”€â”€ appointment.js             â­ æ‰€æœ‰é¢„çº¦å’Œå€™è¡¥ç›¸å…³çš„ API è°ƒç”¨
    â”œâ”€ createWaitlist()        â†’ POST /patient/waitlist
    â”œâ”€ getMyWaitlist()         â†’ GET /patient/waitlist
    â”œâ”€ cancelWaitlist()        â†’ DELETE /patient/waitlist/{id}
    â””â”€ cancelAppointment()     â†’ è§¦å‘åç«¯å€™è¡¥è½¬é¢„çº¦é€»è¾‘
```

### ğŸ”— æ•°æ®æµå…³ç³»å›¾

```
ç”¨æˆ·æ“ä½œ                    å‰ç«¯é¡µé¢                    API æ¥å£              åç«¯æ•°æ®åº“
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

é€‰æ‹©åŒ»ç”Ÿï¼Œçº¦æ»¡
    â†“
ç‚¹å‡»"åŠ å…¥å€™è¡¥"
    â†“
[select-doctor.vue]
    â†“ navigateTo
[confirm-waitlist.vue]
    â”œâ”€ æ˜¾ç¤ºå°±è¯Šäººã€æ—¶é—´ç­‰ä¿¡æ¯
    â””â”€ æŒ‰é’®ï¼š"ç¡®è®¤å€™è¡¥"
        â†“
        â”œâ”€ createWaitlist()
        â”‚   â†“ POST /patient/waitlist
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ åç«¯æ ¡éªŒã€ä¿å­˜
        â”‚                       â””â†’ INSERT Waitlist (status='waiting')
        â”‚
        â””â”€ è·³è½¬åˆ°
    [waitlist-success.vue]
        â”œâ”€ æ˜¾ç¤ºå€™è¡¥æˆåŠŸ
        â”œâ”€ å€™è¡¥ä½ç½®ã€æˆªæ­¢æ—¶é—´
        â””â”€ æŒ‰é’®ï¼š"è¿”å›" æˆ– "æŸ¥çœ‹æˆ‘çš„å€™è¡¥"


ç”¨æˆ·è¿”å›ï¼ŒæŸ¥çœ‹å€™è¡¥
    â†“
æ‰“å¼€"æˆ‘çš„å€™è¡¥"
    â†“
[waitlist.vue]
    â”œâ”€ onMounted() â†’ loadWaitlist()
    â”‚   â†“ GET /patient/waitlist
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¿”å›å€™è¡¥åˆ—è¡¨ï¼ˆåŒ…æ‹¬ statusï¼‰
    â”‚
    â””â”€ æ˜¾ç¤ºåˆ—è¡¨
        â”œâ”€ status='waiting'    â†’ "â³ å€™è¡¥ä¸­"
        â”œâ”€ status='success'    â†’ "âœ… å·²è½¬ä¸ºé¢„çº¦"  ã€åç«¯æ›´æ–°çš„ã€‘
        â”œâ”€ status='expired'    â†’ "âŒ å·²è¿‡æœŸ"      ã€å®šæ—¶ä»»åŠ¡æ›´æ–°çš„ã€‘
        â””â”€ status='cancelled'  â†’ "âŒ å·²å–æ¶ˆ"


ã€åç«¯äº‹ä»¶ã€‘
å½“æœ‰ç”¨æˆ·å–æ¶ˆé¢„çº¦æ—¶
    â†“
[appointments.vue]
    â”œâ”€ cancelAppointment()
    â”‚   â†“ DELETE /patient/appointments/{id}
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ åç«¯æ¥æ”¶
    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ åç«¯æ ¸å¿ƒé€»è¾‘ï¼š
                                            1. UPDATE Appointment SET status='cancelled'
                                            2. UPDATE Schedule SET availableSlots+1
                                            3. SELECT * FROM Waitlist WHERE scheduleId=? AND status='waiting'
                                            4. å¦‚æœæœ‰å€™è¡¥ä¸”æœªè¿‡æœŸï¼š
                                               - INSERT Appointment (æ–°é¢„çº¦)
                                               - UPDATE Waitlist SET status='success', appointmentId=?
                                            5. è¿”å›ç»“æœ

å†æ¬¡æ‰“å¼€"æˆ‘çš„å€™è¡¥"æ—¶
    â†“
[waitlist.vue]
    â”œâ”€ onShow() â†’ loadWaitlist()
    â”‚   â†“ GET /patient/waitlist
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ åç«¯è¿”å›æ›´æ–°åçš„åˆ—è¡¨
    â”‚
    â””â”€ æ˜¾ç¤ºæ›´æ–°åçš„çŠ¶æ€
        â””â”€ åŸæ¥å€™è¡¥ä¸­çš„è®¢å•ï¼Œç°åœ¨æ˜¾ç¤º "âœ… å·²è½¬ä¸ºé¢„çº¦"

ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…" æˆ–å‰å¾€"æˆ‘çš„é¢„çº¦"
    â†“
[appointments.vue]
    â”œâ”€ onShow() è‡ªåŠ¨åŠ è½½æœ€æ–°é¢„çº¦
    â”‚   â†“ GET /patient/appointments
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è¿”å›åŒ…æ‹¬è½¬é¢„çº¦åçš„æ–°è®¢å•
    â”‚
    â””â”€ æ˜¾ç¤ºæ–°çš„é¢„çº¦å•
        â””â”€ sourceType='waitlist' è¡¨ç¤ºæ¥è‡ªå€™è¡¥è½¬é¢„çº¦
```

---

## å®ç°æ­¥éª¤

### ğŸ¯ åç«¯å¼€å‘è·¯çº¿å›¾

#### **ç¬¬1é˜¶æ®µï¼šæ•°æ®åº“è®¾è®¡**
- [ ] åˆ›å»º `Waitlist` è¡¨ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µ
- [ ] æ‰©å±• `Appointment` è¡¨ï¼Œæ·»åŠ  `sourceType` å’Œ `sourceWaitlistId`
- [ ] æ‰©å±• `Schedule` è¡¨ï¼Œæ·»åŠ  `availableSlots` å’Œ `waitlistCount`
- [ ] åˆ›å»ºæ‰€éœ€çš„æ•°æ®åº“ç´¢å¼•

#### **ç¬¬2é˜¶æ®µï¼šAPI å®ç°**
- [ ] å®ç° `POST /patient/waitlist` - åˆ›å»ºå€™è¡¥
- [ ] å®ç° `GET /patient/waitlist` - è·å–å€™è¡¥åˆ—è¡¨
- [ ] å®ç° `DELETE /patient/waitlist/{id}` - å–æ¶ˆå€™è¡¥
- [ ] **ã€æ ¸å¿ƒã€‘** æ›´æ–° `DELETE /patient/appointments/{id}` - å–æ¶ˆé¢„çº¦æ—¶è§¦å‘è½¬é¢„çº¦
- [ ] å®ç° `GET /patient/appointments` - è¿”å›åŒ…å«è½¬é¢„çº¦åçš„é¢„çº¦

#### **ç¬¬3é˜¶æ®µï¼šå®šæ—¶ä»»åŠ¡**
- [ ] å®ç°è¿‡æœŸå€™è¡¥è‡ªåŠ¨æ›´æ–°ä»»åŠ¡
- [ ] å®ç°å€™è¡¥è½¬é¢„çº¦è‡ªåŠ¨è§¦å‘ä»»åŠ¡
- [ ] é…ç½®ä»»åŠ¡æ‰§è¡Œæ—¶é—´å’Œæ—¥å¿—

#### **ç¬¬4é˜¶æ®µï¼šæµ‹è¯•**
- [ ] å•å…ƒæµ‹è¯•ï¼šæ¯ä¸ª API çš„ä¸šåŠ¡é€»è¾‘
- [ ] é›†æˆæµ‹è¯•ï¼šå€™è¡¥åˆ›å»ºâ†’å–æ¶ˆé¢„çº¦â†’å€™è¡¥è½¬é¢„çº¦çš„å®Œæ•´æµç¨‹
- [ ] æ€§èƒ½æµ‹è¯•ï¼šå®šæ—¶ä»»åŠ¡åœ¨å¤§é‡æ•°æ®ä¸‹çš„è¡¨ç°
- [ ] è¾¹ç•Œæµ‹è¯•ï¼šè¿‡æœŸæ—¶é—´ã€é‡å¤æäº¤ã€è¶…å‡ºé™åˆ¶ç­‰

#### **ç¬¬5é˜¶æ®µï¼šå‰ç«¯é›†æˆ**
- [ ] åç«¯ API éƒ¨ç½²å®Œæˆ
- [ ] å‰ç«¯åˆ‡æ¢ `USE_MOCK = false`
- [ ] å‰ç«¯æŒ‡å‘æ­£ç¡®çš„åç«¯ API åœ°å€
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•

---

## æµ‹è¯•åœºæ™¯

### ğŸ§ª å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹

#### **åœºæ™¯1ï¼šåŸºç¡€å€™è¡¥æµç¨‹**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Aè®¿é—®å¿ƒå†…ç§‘æ™®é€šé—¨è¯Šï¼Œ11æœˆ13æ—¥ä¸Šåˆ
2. å‘ç°è¯¥æ—¶æ®µå·²çº¦æ»¡ (availableSlots=0)
3. ç‚¹å‡»"åŠ å…¥å€™è¡¥"
4. æäº¤å€™è¡¥ç”³è¯·
5. ç³»ç»Ÿè¿”å› position=1, expiryDate=2024-11-12, expiryTime=18:00

éªŒè¯ï¼š
âœ… å€™è¡¥è®°å½•å·²ä¿å­˜åˆ°æ•°æ®åº“
âœ… status='waiting'
âœ… å‰ç«¯æ˜¾ç¤º"å€™è¡¥ä¸­"
```

#### **åœºæ™¯2ï¼šå€™è¡¥è½¬é¢„çº¦ï¼ˆå› ä»–äººå–æ¶ˆï¼‰**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Bæœ‰è¯¥æ’ç­çš„é¢„çº¦ï¼ˆqueueNumber=5ï¼‰
2. ç”¨æˆ·Bå–æ¶ˆé¢„çº¦
3. ç³»ç»Ÿç«‹å³æ£€æŸ¥è¯¥æ’ç­çš„å€™è¡¥é˜Ÿåˆ—
4. å‘ç°ç”¨æˆ·Açš„å€™è¡¥ï¼ˆposition=1, status='waiting'ï¼‰
5. è‡ªåŠ¨ä¸ºç”¨æˆ·Aåˆ›å»ºæ–°é¢„çº¦
6. æ›´æ–°ç”¨æˆ·Açš„å€™è¡¥ï¼šstatus='success', appointmentId='appt_123'

éªŒè¯ï¼š
âœ… ç”¨æˆ·Bçš„é¢„çº¦è¢«æ ‡è®°ä¸º 'cancelled'
âœ… Schedule çš„ availableSlots ä»0å¢åŠ åˆ°1
âœ… åˆ›å»ºäº†æ–°çš„ Appointment è®°å½•
âœ… æ–°Appointmentçš„ sourceType='waitlist', sourceWaitlistId='waitlist_001'
âœ… ç”¨æˆ·Açš„ Waitlist è®°å½•æ›´æ–°ä¸º status='success'
âœ… ç”¨æˆ·Aåˆ·æ–°"æˆ‘çš„å€™è¡¥"åçœ‹åˆ°"âœ… å·²è½¬ä¸ºé¢„çº¦"
âœ… ç”¨æˆ·Aè®¿é—®"æˆ‘çš„é¢„çº¦"èƒ½çœ‹åˆ°æ–°é¢„çº¦
```

#### **åœºæ™¯3ï¼šå€™è¡¥è¿‡æœŸ**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Cçš„å€™è¡¥åˆ›å»ºäº 2024-11-11 10:00
2. å°±è¯Šæ—¥æœŸä¸º 2024-11-13
3. æˆªæ­¢æ—¶é—´ä¸º 2024-11-12 18:00
4. æ—¶é—´æ¨è¿›åˆ° 2024-11-12 18:01
5. å®šæ—¶ä»»åŠ¡è¿è¡Œæ£€æŸ¥è¿‡æœŸå€™è¡¥

éªŒè¯ï¼š
âœ… å€™è¡¥è¢«è‡ªåŠ¨æ ‡è®°ä¸º status='expired'
âœ… ç”¨æˆ·Cæ”¶åˆ°"å€™è¡¥å·²è¿‡æœŸ"çš„é€šçŸ¥
âœ… ç”¨æˆ·Cçš„å€™è¡¥åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤º"âŒ å·²è¿‡æœŸ"
```

#### **åœºæ™¯4ï¼šç”¨æˆ·å–æ¶ˆå€™è¡¥**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Dçš„å€™è¡¥ position=2
2. ç”¨æˆ·Dç‚¹å‡»"å–æ¶ˆå€™è¡¥"
3. ç¡®è®¤å–æ¶ˆ

éªŒè¯ï¼š
âœ… å€™è¡¥è¢«æ ‡è®°ä¸º status='cancelled'
âœ… position=3 åŠä»¥åçš„å€™è¡¥è‡ªåŠ¨å¾€å‰ç§»ä½ï¼ˆposition-1ï¼‰
âœ… ç”¨æˆ·Dçš„å€™è¡¥æ˜¾ç¤º"âŒ å·²å–æ¶ˆ"
```

#### **åœºæ™¯5ï¼šå€™è¡¥è¶…é™**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Eå·²æœ‰3ä¸ªå€™è¡¥
2. å°è¯•æ·»åŠ ç¬¬4ä¸ªå€™è¡¥

éªŒè¯ï¼š
âŒ æç¤º"åŒæ—¶æœ€å¤šå¯æäº¤3ä¸ªå€™è¡¥è®¢å•"
```

#### **åœºæ™¯6ï¼šé‡å¤å€™è¡¥**
```
æ­¥éª¤ï¼š
1. ç”¨æˆ·Få·²æœ‰å¿ƒå†…ç§‘æ™®é€šé—¨è¯Šçš„å€™è¡¥
2. å†æ¬¡ç”³è¯·åŒä¸€ç§‘å®¤åŒä¸€ç±»å‹çš„å€™è¡¥

éªŒè¯ï¼š
âŒ æç¤º"åŒä¸€ç§‘å®¤åŒä¸€ç±»å‹çš„å€™è¡¥ä¸èƒ½é‡å¤æäº¤"
```

---

## é™„å½•ï¼šå‰ç«¯ä»£ç å‚è€ƒ

### å‰ç«¯å¦‚ä½•è¯†åˆ«å€™è¡¥è½¬é¢„çº¦

#### **åœ¨"æˆ‘çš„å€™è¡¥"é¡µé¢**
```vue
<!-- src/pages/profile/waitlist.vue -->
<view class="card-status">
  <text v-if="item.status === 'waiting'" class="status-waiting">
    â³ å€™è¡¥ä¸­
  </text>
  <text v-else-if="item.status === 'success'" class="status-success">
    âœ… å·²è½¬ä¸ºé¢„çº¦
  </text>
  <text v-else-if="item.status === 'expired'" class="status-expired">
    âŒ å·²è¿‡æœŸ
  </text>
  <text v-else-if="item.status === 'cancelled'" class="status-cancelled">
    âŒ å·²å–æ¶ˆ
  </text>
</view>

<!-- å½“çŠ¶æ€ä¸º 'success' æ—¶æ˜¾ç¤ºæŸ¥çœ‹æ–°é¢„çº¦çš„æŒ‰é’® -->
<button 
  v-if="item.status === 'success'"
  @tap="goToNewAppointment(item.appointmentId)"
  class="view-appointment-btn"
>
  æŸ¥çœ‹é¢„çº¦
</button>
```

#### **åœ¨"æˆ‘çš„é¢„çº¦"é¡µé¢**
```vue
<!-- src/pages/profile/appointments.vue -->
<!-- æ˜¾ç¤ºæ¥è‡ªå€™è¡¥çš„é¢„çº¦ï¼Œä¸æ™®é€šé¢„çº¦åŒºåˆ† -->
<view v-if="appointment.sourceType === 'waitlist'" class="source-badge">
  <text class="badge-text">ğŸ« ç”±å€™è¡¥è½¬é¢„çº¦</text>
</view>
```

#### **å€™è¡¥è¯¦æƒ…é¡µé¢**
```vue
<!-- src/pages/home/appointment/waitlist-success.vue -->
<!-- å½“ä»URLå‚æ•°è·å– status='success' æ—¶ -->
<view v-if="status === 'success'" class="success-message">
  <text class="main-text">ğŸ‰ å€™è¡¥æˆåŠŸï¼</text>
  <text class="sub-text">æ‚¨çš„å€™è¡¥å·²è‡ªåŠ¨è½¬ä¸ºé¢„çº¦ï¼Œè¯·æŒ‰æ—¶å°±è¯Š</text>
  <button @tap="goToAppointment" class="action-btn">
    å‰å¾€"æˆ‘çš„é¢„çº¦"æŸ¥çœ‹
  </button>
</view>
```

---

## æ€»ç»“

| åŠŸèƒ½ | åç«¯å®ç° | å‰ç«¯å®ç° | çŠ¶æ€ |
|------|--------|--------|------|
| åˆ›å»ºå€™è¡¥ | âœ… API | âœ… å®Œæˆ | å°±ç»ª |
| å–æ¶ˆå€™è¡¥ | âœ… API | âœ… å®Œæˆ | å°±ç»ª |
| è·å–å€™è¡¥åˆ—è¡¨ | âœ… API | âœ… å®Œæˆ | å°±ç»ª |
| **å–æ¶ˆé¢„çº¦è§¦å‘è½¬é¢„çº¦** | **â³ éœ€å®ç°** | âœ… å®Œæˆ | é˜»å¡ |
| **å®šæ—¶æ£€æŸ¥è¿‡æœŸå€™è¡¥** | **â³ éœ€å®ç°** | âœ… N/A | é˜»å¡ |
| **å®šæ—¶è‡ªåŠ¨è½¬é¢„çº¦** | **â³ éœ€å®ç°** | âœ… N/A | é˜»å¡ |

**å…³é”®ç‚¹**ï¼š
- åç«¯éœ€è¦åœ¨"å–æ¶ˆé¢„çº¦"æ—¶ç«‹å³è§¦å‘å€™è¡¥è½¬é¢„çº¦é€»è¾‘ï¼ˆæœ€å…³é”®ï¼ï¼‰
- éœ€è¦é…ç½®ä¸¤ä¸ªå®šæ—¶ä»»åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å‰ç«¯å·²å®Œå…¨å‡†å¤‡å¥½ï¼Œåªéœ€ç­‰å¾…åç«¯ API å°±ç»ª

ğŸš€ **å»ºè®®ï¼šå…ˆä¼˜å…ˆå®ç°"å–æ¶ˆé¢„çº¦è§¦å‘è½¬é¢„çº¦"é€»è¾‘ï¼Œè¿™æ˜¯ç”¨æˆ·æœ€å…³å¿ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼**
