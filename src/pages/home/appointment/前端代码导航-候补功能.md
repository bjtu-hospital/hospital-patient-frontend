# ğŸ“± å‰ç«¯ä»£ç å¯¼èˆª - å€™è¡¥åŠŸèƒ½ç›¸å…³æ–‡ä»¶

## ğŸ“‚ ç›®å½•ç»“æ„ä¸åŠŸèƒ½å¯¹åº”

```
src/pages/home/appointment/
â”œâ”€â”€ ğŸ“„ appointment-mock.js          ã€Mockæ•°æ®ã€‘å€™è¡¥å’Œæ’ç­Mockæ•°æ®
â”œâ”€â”€ ğŸ“„ select-hospital.vue          ã€ç¬¬1æ­¥ã€‘é€‰æ‹©åŒ»é™¢
â”œâ”€â”€ ğŸ“„ select-department.vue        ã€ç¬¬2æ­¥ã€‘é€‰æ‹©ç§‘å®¤
â”œâ”€â”€ ğŸ“„ select-doctor.vue            ã€ç¬¬3æ­¥ã€‘é€‰æ‹©åŒ»ç”Ÿ â­ å€™è¡¥å…¥å£
â”œâ”€â”€ ğŸ“„ confirm.vue                  ã€ç¬¬4æ­¥ã€‘ç¡®è®¤é¢„çº¦ï¼ˆæ™®é€šé¢„çº¦ï¼‰
â”œâ”€â”€ ğŸ“„ confirm-waitlist.vue         ã€ç¬¬4æ­¥ã€‘ç¡®è®¤å€™è¡¥ â­ å€™è¡¥ç¡®è®¤é¡µ
â”œâ”€â”€ ğŸ“„ success.vue                  ã€ç¬¬5æ­¥ã€‘é¢„çº¦æˆåŠŸï¼ˆæ”¯ä»˜é¡µï¼‰
â””â”€â”€ ğŸ“„ waitlist-success.vue         ã€ç¬¬5æ­¥ã€‘å€™è¡¥æˆåŠŸ â­ å€™è¡¥æˆåŠŸé¡µ

src/pages/profile/
â”œâ”€â”€ ğŸ“„ index.vue                    ä¸ªäººä¸­å¿ƒï¼ˆå¯¼èˆªå…¥å£ï¼‰
â”œâ”€â”€ ğŸ“„ appointments.vue             æˆ‘çš„é¢„çº¦ â­ æ˜¾ç¤ºå€™è¡¥è½¬åçš„é¢„çº¦
â”œâ”€â”€ ğŸ“„ waitlist.vue                 æˆ‘çš„å€™è¡¥ â­ å€™è¡¥åˆ—è¡¨ç®¡ç†
â””â”€â”€ ğŸ“„ health.vue                   å¥åº·æ¡£æ¡ˆ

src/api/
â”œâ”€â”€ ğŸ“„ request.js                   HTTPè¯·æ±‚é…ç½®
â””â”€â”€ ğŸ“„ appointment.js               â­ æ‰€æœ‰é¢„çº¦å’Œå€™è¡¥APIè°ƒç”¨

src/stores/
â””â”€â”€ ğŸ“„ appointment.js               PiniaçŠ¶æ€ç®¡ç† â­ å€™è¡¥æµç¨‹æ•°æ®

src/components/
â”œâ”€â”€ ğŸ“„ AppointmentCard.vue          é¢„çº¦å¡ç‰‡ç»„ä»¶
â””â”€â”€ ğŸ“„ EmptyState.vue               ç©ºçŠ¶æ€ç»„ä»¶
```

---

## ğŸ”„ ç”¨æˆ·æ“ä½œæµç¨‹ â†’ å¯¹åº”æ–‡ä»¶

### ğŸ“ åœºæ™¯1ï¼šç”¨æˆ·åˆ›å»ºå€™è¡¥

```
ä¸»é¡µé¦–é¡µ
  â†“ ç‚¹å‡»"é¢„çº¦æŒ‚å·"
[select-hospital.vue] 
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šåŒ»é™¢åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œåˆ†ç±»
  â”œâ”€ å…³é”®ä»£ç ï¼šselectHospital() â†’ ä¿å­˜åˆ° Store
  â””â”€ å¯¼å‘ï¼šé€‰æ‹©åŒ»é™¢åè¿›å…¥ç§‘å®¤é€‰æ‹©
  â†“ ç‚¹å‡»æŸåŒ»é™¢

[select-department.vue]
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šè¯¥åŒ»é™¢çš„ç§‘å®¤åˆ—è¡¨
  â”œâ”€ å…³é”®ä»£ç ï¼šgetDepartments(hospitalId)
  â”œâ”€ æ•°æ®æ¥æºï¼šsrc/api/appointment.js â†’ getDepartments()
  â””â”€ å¯¼å‘ï¼šé€‰æ‹©ç§‘å®¤åè¿›å…¥åŒ»ç”Ÿé€‰æ‹©
  â†“ ç‚¹å‡»æŸç§‘å®¤

[select-doctor.vue] â­ å…³é”®ï¼šå€™è¡¥çš„å…¥å£åœ¨è¿™é‡Œ
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šæ˜¾ç¤ºè¯¥ç§‘å®¤æ‰€æœ‰åŒ»ç”Ÿçš„æ’ç­
  â”œâ”€ å…³é”®ä»£ç ï¼š
  â”‚   â”œâ”€ getDoctorSchedules() è·å–æ’ç­
  â”‚   â”œâ”€ schedule.availableSlots === 0 åˆ¤æ–­æ˜¯å¦çº¦æ»¡
  â”‚   â”œâ”€ çº¦æ»¡æ—¶æ˜¾ç¤º"åŠ å…¥å€™è¡¥"æŒ‰é’®
  â”‚   â””â”€ joinWaitlist(schedule) â†’ è·³è½¬åˆ°å€™è¡¥ç¡®è®¤é¡µ
  â”œâ”€ æ•°æ®æ¥æºï¼šMock æ•°æ®ä¸­çš„ mockSchedules
  â””â”€ å¯¼å‘ï¼šç‚¹å‡»"åŠ å…¥å€™è¡¥"æˆ–"ç¡®è®¤é¢„çº¦"
  â†“ ç‚¹å‡»"åŠ å…¥å€™è¡¥"

[confirm-waitlist.vue] â­ å€™è¡¥æµç¨‹æ ¸å¿ƒé¡µé¢
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šç¡®è®¤å€™è¡¥çš„å°±è¯Šäººå’Œæ—¶é—´
  â”œâ”€ å…³é”®ä»£ç ï¼š
  â”‚   â”œâ”€ selectPatient() ä»APIè·å–å°±è¯Šäººåˆ—è¡¨
  â”‚   â”œâ”€ confirmWaitlist() æäº¤å€™è¡¥è¯·æ±‚
  â”‚   â”‚   â†“ è°ƒç”¨ src/api/appointment.js â†’ createWaitlist()
  â”‚   â”‚   â†“ POST /patient/waitlist
  â”‚   â”‚   â†“ è¿”å› { waitlistId, position }
  â”‚   â”œâ”€ æ¸…ç©ºStoreæ•°æ®ï¼šappointmentStore.clearAppointmentData()
  â”‚   â””â”€ è·³è½¬åˆ°å€™è¡¥æˆåŠŸé¡µ
  â””â”€ å¯¼å‘ï¼šæäº¤åè¿›å…¥å€™è¡¥æˆåŠŸé¡µ
  â†“ å€™è¡¥æˆåŠŸ

[waitlist-success.vue] â­ å€™è¡¥æˆåŠŸè¯¦æƒ…é¡µ
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šæ˜¾ç¤ºå€™è¡¥çš„è¯¦ç»†ä¿¡æ¯å’ŒçŠ¶æ€
  â”œâ”€ URLå‚æ•°ï¼šwaitlistId, position, status(å¯é€‰)
  â”œâ”€ å…³é”®ä»£ç ï¼š
  â”‚   â”œâ”€ status.value ä»URLå‚æ•°è·å–çŠ¶æ€
  â”‚   â”œâ”€ statusTitle/statusDesc æ ¹æ®statusæ˜¾ç¤ºä¸åŒæ–‡æ¡ˆ
  â”‚   â”‚   â”œâ”€ status='waiting' â†’ "å€™è¡¥ä¸­"
  â”‚   â”‚   â”œâ”€ status='success' â†’ "âœ… å·²æˆåŠŸè½¬ä¸ºé¢„çº¦" ã€åç«¯æ›´æ–°ã€‘
  â”‚   â”‚   â”œâ”€ status='expired' â†’ "å·²è¿‡æœŸ"
  â”‚   â”‚   â””â”€ status='cancelled' â†’ "å·²å–æ¶ˆ"
  â”‚   â”œâ”€ cancelWaitlist() å–æ¶ˆå€™è¡¥
  â”‚   â””â”€ æ—¶é—´æ˜¾ç¤ºï¼šexpiryTimeï¼ˆæˆªæ­¢18:00ï¼‰
  â””â”€ å¯¼å‘ï¼šç”¨æˆ·å¯è¿”å›ä¸»é¡µæˆ–æŸ¥çœ‹æˆ‘çš„å€™è¡¥

ç”¨æˆ·æ‰“å¼€"æˆ‘çš„å€™è¡¥"é¡µé¢
  â†“
[waitlist.vue] â­ å€™è¡¥åˆ—è¡¨ç®¡ç†é¡µ
  â”œâ”€ ä¸»è¦åŠŸèƒ½ï¼šåˆ—è¡¨æ˜¾ç¤ºç”¨æˆ·æ‰€æœ‰å€™è¡¥
  â”œâ”€ å…³é”®ä»£ç ï¼š
  â”‚   â”œâ”€ loadWaitlist() åŠ è½½åˆ—è¡¨
  â”‚   â”‚   â†“ src/api/appointment.js â†’ getMyWaitlist()
  â”‚   â”‚   â†“ GET /patient/waitlist
  â”‚   â”œâ”€ viewDetail(item) æŸ¥çœ‹å€™è¡¥è¯¦æƒ…
  â”‚   â”‚   â””â”€ navigateTo waitlist-success.vue?status=item.status
  â”‚   â”œâ”€ handleCancel(id) å–æ¶ˆå€™è¡¥
  â”‚   â”‚   â””â”€ src/api/appointment.js â†’ cancelWaitlist()
  â”‚   â”œâ”€ getStatusClass(status) çŠ¶æ€æ ·å¼
  â”‚   â””â”€ getStatusText(status) çŠ¶æ€æ–‡æœ¬
  â”‚       â”œâ”€ 'waiting' â†’ "â³ å€™è¡¥ä¸­"
  â”‚       â”œâ”€ 'success' â†’ "âœ… å·²æˆåŠŸ" ã€åç«¯æ›´æ–°æ—¶æ˜¾ç¤ºã€‘
  â”‚       â”œâ”€ 'expired' â†’ "âŒ å·²è¿‡æœŸ"
  â”‚       â””â”€ 'cancelled' â†’ "âŒ å·²å–æ¶ˆ"
  â””â”€ å¯¼å‘ï¼šæŸ¥çœ‹è¯¦æƒ…æˆ–è¿”å›
```

### ğŸ“ åœºæ™¯2ï¼šå€™è¡¥è½¬é¢„çº¦ï¼ˆåç«¯æ›´æ–°åï¼‰

```
ã€åç«¯äº‹ä»¶ã€‘ç”¨æˆ·å–æ¶ˆé¢„çº¦
  â†“
ç”¨æˆ·æ‰“å¼€"æˆ‘çš„é¢„çº¦"
  â†“
[appointments.vue] â­ é¢„çº¦åˆ—è¡¨é¡µ
  â”œâ”€ onShow() é’©å­ â†’ æ¯æ¬¡æ˜¾ç¤ºæ—¶è‡ªåŠ¨åˆ·æ–°
  â”œâ”€ loadAppointments() åŠ è½½é¢„çº¦
  â”‚   â†“ src/api/appointment.js â†’ getMyAppointments()
  â”‚   â†“ GET /patient/appointments
  â”‚   â†“ ã€å…³é”®ã€‘åç«¯è¿”å›åŒ…æ‹¬ä»å€™è¡¥è½¬è¿‡æ¥çš„æ–°é¢„çº¦
  â”œâ”€ æ˜¾ç¤ºé¢„çº¦åˆ—è¡¨
  â”‚   â”œâ”€ sourceType='normal' â†’ æ™®é€šé¢„çº¦
  â”‚   â””â”€ sourceType='waitlist' â†’ ä»å€™è¡¥è½¬è¿‡æ¥çš„é¢„çº¦ âœ…
  â””â”€ ç”¨æˆ·å¯çœ‹åˆ°æ–°çš„é¢„çº¦å•

ç”¨æˆ·æ‰“å¼€"æˆ‘çš„å€™è¡¥"
  â†“
[waitlist.vue]
  â”œâ”€ onShow() é’©å­ â†’ è‡ªåŠ¨åˆ·æ–°å€™è¡¥åˆ—è¡¨
  â”œâ”€ loadWaitlist() é‡æ–°åŠ è½½
  â”‚   â†“ src/api/appointment.js â†’ getMyWaitlist()
  â”‚   â†“ GET /patient/waitlist
  â”‚   â†“ ã€å…³é”®ã€‘åç«¯è¿”å›æ›´æ–°åçš„status='success'
  â”œâ”€ æ˜¾ç¤ºæ›´æ–°åçš„çŠ¶æ€
  â”‚   â””â”€ åŸæ¥ 'waiting' çš„å€™è¡¥ï¼Œç°åœ¨æ˜¾ç¤º 'success' âœ…
  â””â”€ ç”¨æˆ·å¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
```

---

## ğŸ“ æ ¸å¿ƒä»£ç æ–‡ä»¶è¯¦è§£

### 1ï¸âƒ£ `select-doctor.vue` - å€™è¡¥å…¥å£

**æ–‡ä»¶ä½ç½®**: `src/pages/home/appointment/select-doctor.vue`

**å…³é”®ä»£ç æ®µ**:

```vue
<!-- æ¨¡æ¿ï¼šçº¦æ»¡æ—¶æ˜¾ç¤ºå€™è¡¥æŒ‰é’® -->
<button v-if="schedule.availableSlots === 0" @tap="joinWaitlist(schedule)">
  åŠ å…¥å€™è¡¥
</button>

<!-- è„šæœ¬ï¼šè·³è½¬åˆ°å€™è¡¥ç¡®è®¤é¡µ -->
<script setup>
const joinWaitlist = (schedule) => {
  // ä¿å­˜é€‰ä¸­çš„æ’ç­åˆ° Store
  appointmentStore.setSelectedSchedule(schedule)
  
  // è·³è½¬åˆ°å€™è¡¥ç¡®è®¤é¡µé¢
  uni.navigateTo({
    url: '/pages/home/appointment/confirm-waitlist'
  })
}
</script>
```

**ä¸šåŠ¡é€»è¾‘**:
- åˆ¤æ–­ `availableSlots === 0` ç¡®å®šæ˜¯å¦æ˜¾ç¤ºå€™è¡¥æŒ‰é’®
- ä¿å­˜é€‰æ‹©çš„æ’ç­åˆ°å…¨å±€ Store
- è·³è½¬åˆ°å€™è¡¥ç¡®è®¤é¡µé¢

---

### 2ï¸âƒ£ `confirm-waitlist.vue` - å€™è¡¥ç¡®è®¤é¡µ

**æ–‡ä»¶ä½ç½®**: `src/pages/home/appointment/confirm-waitlist.vue`

**å…³é”®ä»£ç æ®µ**:

```vue
<script setup>
import { createWaitlist } from '@/api/appointment'

// ç¡®è®¤å€™è¡¥çš„æ ¸å¿ƒæ–¹æ³•
const confirmWaitlist = async () => {
  try {
    uni.showLoading({ title: 'åŠ å…¥ä¸­...' })

    // è°ƒç”¨ API åˆ›å»ºå€™è¡¥
    const result = await createWaitlist({
      scheduleId: schedule.value.id,
      patientId: selectedPatient.value.id
    })

    uni.hideLoading()

    // æ¸…ç©ºé¢„çº¦æµç¨‹æ•°æ®
    appointmentStore.clearAppointmentData()

    // è·³è½¬åˆ°å€™è¡¥æˆåŠŸé¡µé¢ï¼Œæºå¸¦å€™è¡¥IDå’Œä½ç½®
    uni.redirectTo({
      url: `/pages/home/appointment/waitlist-success?waitlistId=${result.waitlistId}&position=${result.position}`
    })
  } catch (error) {
    uni.hideLoading()
    uni.showToast({
      title: error.message || 'åŠ å…¥å€™è¡¥å¤±è´¥',
      icon: 'none'
    })
  }
}
</script>
```

**ä¸šåŠ¡é€»è¾‘**:
- è·å–å°±è¯Šäººåˆ—è¡¨
- æäº¤å€™è¡¥è¯·æ±‚åˆ°åç«¯
- æ¸…ç©º Store é˜²æ­¢æ•°æ®æ±¡æŸ“
- è·³è½¬åˆ°æˆåŠŸé¡µé¢

**é‡è¦æç¤º**:
- ğŸ’¡ `clearAppointmentData()` ç¡®ä¿ä¸‹æ¬¡é¢„çº¦æµç¨‹ä»å¹²å‡€çŠ¶æ€å¼€å§‹
- ğŸ’¡ ä½¿ç”¨ `redirectTo` è€Œä¸æ˜¯ `navigateTo`ï¼Œé¿å…è¿”å›æ—¶é‡å¤æäº¤

---

### 3ï¸âƒ£ `waitlist-success.vue` - å€™è¡¥æˆåŠŸ/çŠ¶æ€é¡µ

**æ–‡ä»¶ä½ç½®**: `src/pages/home/appointment/waitlist-success.vue`

**å…³é”®ä»£ç æ®µ**:

```vue
<script setup>
import { ref, computed } from 'vue'

// ä»URLå‚æ•°è·å–çŠ¶æ€
const status = ref('waiting')  // waiting/success/expired/cancelled

// æ ¹æ®çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„æ ‡é¢˜
const statusTitle = computed(() => {
  if (status.value === 'waiting') {
    return 'å€™è¡¥ä¸­'
  } else if (status.value === 'success') {
    return 'âœ… å·²è½¬ä¸ºé¢„çº¦'  // â† å…³é”®ï¼šåç«¯æ›´æ–°statusåæ˜¾ç¤º
  } else if (status.value === 'expired') {
    return 'å€™è¡¥å·²è¿‡æœŸ'
  } else if (status.value === 'cancelled') {
    return 'å·²å–æ¶ˆ'
  }
  return ''
})

// æ ¹æ®çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„æè¿°
const statusDesc = computed(() => {
  if (status.value === 'waiting') {
    return 'è¯·è€å¿ƒç­‰å¾…ï¼Œå·æºé‡Šæ”¾æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨è½¬ä¸ºé¢„çº¦'
  } else if (status.value === 'success') {
    return 'æ­å–œï¼æ‚¨çš„å€™è¡¥å·²æˆåŠŸè½¬ä¸ºé¢„çº¦ï¼Œè¯·æŒ‰æ—¶å°±è¯Š'  // â† å…³é”®
  } else if (status.value === 'expired') {
    return 'å€™è¡¥å·²è¿‡æœŸï¼Œè¯·é‡æ–°å€™è¡¥æˆ–é¢„çº¦'
  } else if (status.value === 'cancelled') {
    return 'æ‚¨å·²å–æ¶ˆè¯¥å€™è¡¥'
  }
})

onMounted(() => {
  // è·å–URLå‚æ•°
  const pages = getCurrentPages()
  const currentPage = pages[pages.length - 1]
  const options = currentPage.options
  
  // è·å–statuså‚æ•°ï¼ˆåç«¯æ›´æ–°å€™è¡¥ä¸ºsuccessæ—¶ä¼ é€’ï¼‰
  if (options.status) {
    status.value = options.status  // â† è¿™å°±æ˜¯åç«¯æ›´æ–°çš„çŠ¶æ€
  }
})
</script>
```

**ä¸šåŠ¡é€»è¾‘**:
- é€šè¿‡ URL å‚æ•° `status` åˆ¤æ–­å€™è¡¥çš„çŠ¶æ€
- æ ¹æ®ä¸åŒçŠ¶æ€æ˜¾ç¤ºä¸åŒçš„æ–‡æ¡ˆå’ŒæŒ‰é’®
- æ”¯æŒå®æ—¶æ˜¾ç¤ºåç«¯æ›´æ–°çš„ `status='success'` çŠ¶æ€

**å…³é”®ç‚¹** ğŸ”‘:
```
å½“åç«¯æŠŠå€™è¡¥çŠ¶æ€æ›´æ–°ä¸º 'success' æ—¶ï¼š
1. ç”¨æˆ·åˆ·æ–°"æˆ‘çš„å€™è¡¥"é¡µé¢
2. è·å–æœ€æ–°çš„å€™è¡¥æ•°æ®ï¼ˆstatus='success'ï¼‰
3. ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
4. è·³è½¬åˆ° waitlist-success.vue?status=success
5. é¡µé¢æ˜¾ç¤º "âœ… å·²è½¬ä¸ºé¢„çº¦"
```

---

### 4ï¸âƒ£ `waitlist.vue` - å€™è¡¥åˆ—è¡¨é¡µ

**æ–‡ä»¶ä½ç½®**: `src/pages/profile/waitlist.vue`

**å…³é”®ä»£ç æ®µ**:

```vue
<script setup>
import { ref, onMounted, onShow } from 'vue'
import { getMyWaitlist, cancelWaitlist } from '@/api/appointment'

const waitlist = ref([])
const loading = ref(false)

// åŠ è½½å€™è¡¥åˆ—è¡¨
const loadWaitlist = async () => {
  try {
    loading.value = true
    const data = await getMyWaitlist()
    waitlist.value = data || []
  } catch (error) {
    console.error('è·å–å€™è¡¥åˆ—è¡¨å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

// ğŸ“Œ å…³é”®ï¼šæ¯æ¬¡é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°ï¼ˆåç«¯æ›´æ–°statusåèƒ½ç«‹å³æ˜¾ç¤ºï¼‰
onShow(() => {
  console.log('å€™è¡¥é¡µé¢æ˜¾ç¤ºï¼Œé‡æ–°åŠ è½½æ•°æ®')
  loadWaitlist()
})

// æŸ¥çœ‹è¯¦æƒ… - è·³è½¬åˆ°å€™è¡¥è¯¦æƒ…é¡µï¼Œã€ä¼ é€’statuså‚æ•°ã€‘
const viewDetail = (item) => {
  uni.navigateTo({
    url: `/pages/home/appointment/waitlist-success?waitlistId=${item.id}&status=${item.status}`
  })
}

// è·å–çŠ¶æ€æ–‡æœ¬
const getStatusText = (status) => {
  const textMap = {
    'waiting': 'â³ å€™è¡¥ä¸­',
    'success': 'âœ… å·²è½¬ä¸ºé¢„çº¦',  // â† åç«¯æ›´æ–°æ—¶æ˜¾ç¤º
    'expired': 'âŒ å·²è¿‡æœŸ',
    'cancelled': 'âŒ å·²å–æ¶ˆ'
  }
  return textMap[status] || status
}

// å–æ¶ˆå€™è¡¥
const handleCancel = async (waitlistId) => {
  uni.showModal({
    title: 'å–æ¶ˆå€™è¡¥',
    content: 'ç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ',
    success: async (res) => {
      if (res.confirm) {
        try {
          uni.showLoading({ title: 'å–æ¶ˆä¸­...' })
          await cancelWaitlist(waitlistId)
          uni.hideLoading()
          uni.showToast({ title: 'å·²å–æ¶ˆ', icon: 'success' })
          loadWaitlist()  // é‡æ–°åŠ è½½åˆ—è¡¨
        } catch (error) {
          uni.hideLoading()
          uni.showToast({ title: error.message || 'å–æ¶ˆå¤±è´¥', icon: 'none' })
        }
      }
    }
  })
}
</script>

<template>
  <!-- å€™è¡¥å¡ç‰‡ -->
  <view class="waitlist-card" v-for="item in waitlist" :key="item.id">
    <!-- æ˜¾ç¤ºçŠ¶æ€ -->
    <view class="status-badge" :class="getStatusClass(item.status)">
      <text>{{ getStatusText(item.status) }}</text>
    </view>
    
    <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
    <button @tap="viewDetail(item)">æŸ¥çœ‹è¯¦æƒ…</button>
    
    <!-- åªæœ‰å€™è¡¥ä¸­çš„æ‰èƒ½å–æ¶ˆ -->
    <button v-if="item.status === 'waiting'" @tap="handleCancel(item.id)">
      å–æ¶ˆå€™è¡¥
    </button>
  </view>
</template>
```

**ä¸šåŠ¡é€»è¾‘**:
- `onShow()` é’©å­ç¡®ä¿æ¯æ¬¡æ˜¾ç¤ºæ—¶éƒ½åŠ è½½æœ€æ–°æ•°æ®
- `viewDetail()` ä¼ é€’ `status` å‚æ•°ç»™è¯¦æƒ…é¡µ
- çŠ¶æ€æ–‡æœ¬æ˜ å°„ï¼ŒåŠ¨æ€æ˜¾ç¤ºä¸åŒçš„çŠ¶æ€
- åªæœ‰ `waiting` çŠ¶æ€çš„å€™è¡¥æ‰èƒ½å–æ¶ˆ

**å…³é”®ç‚¹** ğŸ”‘:
```
åç«¯æ›´æ–°å€™è¡¥çŠ¶æ€åï¼š
1. ç”¨æˆ·æ‰“å¼€"æˆ‘çš„å€™è¡¥"é¡µé¢ â†’ onShow() è§¦å‘
2. loadWaitlist() é‡æ–°åŠ è½½åˆ—è¡¨
3. åŸæ¥æ˜¯ status='waiting' çš„å€™è¡¥ï¼Œç°åœ¨æ˜¯ status='success'
4. getStatusText() æ˜¾ç¤º "âœ… å·²è½¬ä¸ºé¢„çº¦"
5. ç”¨æˆ·ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
6. viewDetail() ä¼ é€’ status='success' ç»™ waitlist-success.vue
```

---

### 5ï¸âƒ£ `appointments.vue` - é¢„çº¦åˆ—è¡¨é¡µ

**æ–‡ä»¶ä½ç½®**: `src/pages/profile/appointments.vue`

**å…³é”®ä»£ç æ®µ**:

```vue
<script setup>
import { ref, computed, onMounted, onShow } from 'vue'
import { getMyAppointments } from '@/api/appointment'

const appointments = ref([])

// åŠ è½½é¢„çº¦åˆ—è¡¨
const loadAppointments = async () => {
  try {
    const result = await getMyAppointments({
      page: 1,
      pageSize: 100
    })
    appointments.value = result.list || []
  } catch (error) {
    console.error('è·å–é¢„çº¦åˆ—è¡¨å¤±è´¥:', error)
  }
}

// ğŸ“Œ å…³é”®ï¼šæ¯æ¬¡é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°ï¼ˆå€™è¡¥è½¬é¢„çº¦åèƒ½ç«‹å³æ˜¾ç¤ºï¼‰
onShow(() => {
  console.log('é¢„çº¦é¡µé¢æ˜¾ç¤ºï¼Œé‡æ–°åŠ è½½æ•°æ®')
  loadAppointments()
})
</script>

<template>
  <!-- é¢„çº¦å¡ç‰‡ -->
  <view class="appointment-card" v-for="item in appointments" :key="item.id">
    <!-- ã€æ–°å¢ã€‘æ˜¾ç¤ºæ¥è‡ªå€™è¡¥çš„æ ‡ç­¾ -->
    <view v-if="item.sourceType === 'waitlist'" class="source-badge">
      <text>ğŸ« ç”±å€™è¡¥è½¬é¢„çº¦</text>
    </view>
    
    <!-- é¢„çº¦ä¿¡æ¯ -->
    <text>{{ item.patientName }}</text>
    <text>{{ item.hospitalName }} - {{ item.departmentName }}</text>
    <text>{{ item.appointmentDate }} {{ item.appointmentTime }}</text>
  </view>
</template>
```

**ä¸šåŠ¡é€»è¾‘**:
- `onShow()` ç¡®ä¿å€™è¡¥è½¬é¢„çº¦åèƒ½ç«‹å³æ˜¾ç¤ºæ–°é¢„çº¦
- é€šè¿‡ `sourceType='waitlist'` åŒºåˆ†æ˜¯å¦æ¥è‡ªå€™è¡¥
- å¯é€‰åœ°æ˜¾ç¤º"ç”±å€™è¡¥è½¬é¢„çº¦"çš„æ ‡ç­¾

---

### 6ï¸âƒ£ `src/api/appointment.js` - API æ¥å£å±‚

**æ–‡ä»¶ä½ç½®**: `src/api/appointment.js`

**å…³é”®å‡½æ•°**:

```javascript
/**
 * åˆ›å»ºå€™è¡¥
 */
export const createWaitlist = (data) => {
  if (USE_MOCK) {
    // Mock å®ç°...
  }
  return request.post('/patient/waitlist', data)  // ã€åç«¯APIã€‘
}

/**
 * è·å–æˆ‘çš„å€™è¡¥åˆ—è¡¨
 * ã€å…³é”®ã€‘ä»æœ¬åœ°å­˜å‚¨ + Mock æ•°æ®åˆå¹¶è¿”å›
 */
export const getMyWaitlist = () => {
  if (USE_MOCK) {
    const storedWaitlist = uni.getStorageSync('myWaitlist') || []
    const allWaitlist = [...storedWaitlist, ...mockWaitlist]
    // æ’åºã€å»é‡...
    return Promise.resolve(allWaitlist)
  }
  return request.get('/patient/waitlist')  // ã€åç«¯APIã€‘
}

/**
 * å–æ¶ˆå€™è¡¥
 */
export const cancelWaitlist = (waitlistId) => {
  if (USE_MOCK) {
    // Mock å®ç°...
  }
  return request.delete(`/patient/waitlist/${waitlistId}`)  // ã€åç«¯APIã€‘
}

/**
 * è·å–æˆ‘çš„é¢„çº¦åˆ—è¡¨
 * ã€å…³é”®ã€‘ä¼šåŒ…æ‹¬ä»å€™è¡¥è½¬è¿‡æ¥çš„é¢„çº¦
 */
export const getMyAppointments = (params) => {
  if (USE_MOCK) {
    const storedAppointments = uni.getStorageSync('myAppointments') || []
    const allAppointments = [...storedAppointments, ...mockAppointments]
    // æ’åºã€å»é‡ã€åˆ†é¡µ...
    return Promise.resolve({ list: allAppointments })
  }
  return request.get('/patient/appointments', params)  // ã€åç«¯APIã€‘
}

/**
 * å–æ¶ˆé¢„çº¦
 * ã€å…³é”®ã€‘åç«¯ä¼šåœ¨æ­¤æ—¶æ£€æŸ¥å’Œè½¬æ¢å€™è¡¥
 */
export const cancelAppointment = (appointmentId) => {
  if (USE_MOCK) {
    // Mock å®ç°...
  }
  return request.delete(`/patient/appointments/${appointmentId}`)  // ã€åç«¯APIã€‘
}
```

---

### 7ï¸âƒ£ `src/stores/appointment.js` - çŠ¶æ€ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `src/stores/appointment.js`

**å…³é”®åŠŸèƒ½**:

```javascript
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useAppointmentStore = defineStore('appointment', () => {
  // é¢„çº¦æµç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®
  const selectedHospital = ref(null)
  const selectedDepartment = ref(null)
  const selectedSchedule = ref(null)
  const selectedPatient = ref(null)

  // è®¾ç½®é€‰ä¸­çš„åŒ»é™¢
  const setSelectedHospital = (hospital) => {
    selectedHospital.value = hospital
  }

  // è®¾ç½®é€‰ä¸­çš„ç§‘å®¤
  const setSelectedDepartment = (department) => {
    selectedDepartment.value = department
  }

  // è®¾ç½®é€‰ä¸­çš„æ’ç­
  const setSelectedSchedule = (schedule) => {
    selectedSchedule.value = schedule
  }

  // ã€å…³é”®ã€‘æ¸…ç©ºé¢„çº¦æµç¨‹æ•°æ®
  // åœ¨å€™è¡¥æˆåŠŸæˆ–é¢„çº¦æˆåŠŸåè°ƒç”¨
  const clearAppointmentData = () => {
    selectedHospital.value = null
    selectedDepartment.value = null
    selectedSchedule.value = null
    selectedPatient.value = null
  }

  return {
    selectedHospital,
    selectedDepartment,
    selectedSchedule,
    selectedPatient,
    setSelectedHospital,
    setSelectedDepartment,
    setSelectedSchedule,
    clearAppointmentData
  }
})
```

---

## ğŸ”— API è°ƒç”¨è·¯çº¿å›¾

```
ç”¨æˆ·æ“ä½œ              å‰ç«¯ä»£ç                     åç«¯ API
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â‘  åŠ å…¥å€™è¡¥
  â†“ confirm-waitlist.vue
  â†“ createWaitlist()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ POST /patient/waitlist
  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { waitlistId, position }

â‘¡ æŸ¥çœ‹å€™è¡¥åˆ—è¡¨
  â†“ waitlist.vue
  â†“ getMyWaitlist()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ GET /patient/waitlist
  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [{ id, status, appointmentId, ... }]

â‘¢ æŸ¥çœ‹å€™è¡¥è¯¦æƒ…
  â†“ waitlist.vue â†’ viewDetail()
  â†“ è·³è½¬åˆ° waitlist-success.vue?status=item.status
  (å‰ç«¯æœ¬åœ°æ˜¾ç¤ºï¼Œä¸è°ƒç”¨API)

â‘£ å–æ¶ˆå€™è¡¥
  â†“ waitlist.vue
  â†“ cancelWaitlist()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ DELETE /patient/waitlist/{id}
  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { status: 'cancelled' }

â‘¤ å€™è¡¥è½¬é¢„çº¦ï¼ˆåç«¯äº‹ä»¶ï¼‰
  ã€åç«¯æ£€æµ‹ç”¨æˆ·å–æ¶ˆé¢„çº¦ã€‘
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ DELETE /patient/appointments/{id}
  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ { waitlistConverted: true, newAppointmentId }

â‘¥ åˆ·æ–°é¢„çº¦åˆ—è¡¨
  â†“ appointments.vue
  â†“ getMyAppointments()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ GET /patient/appointments
  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [{ id, sourceType, sourceWaitlistId, ... }]
                 â†‘ sourceType='waitlist' è¡¨ç¤ºæ¥è‡ªå€™è¡¥
```

---

## ğŸ§ª å‰ç«¯æµ‹è¯•æ£€æŸ¥æ¸…å•

### æœ¬åœ° Mock æµ‹è¯•
- [ ] å€™è¡¥åˆ›å»ºï¼šé€‰æ‹©çº¦æ»¡çš„åŒ»ç”Ÿï¼Œåˆ›å»ºå€™è¡¥æˆåŠŸ
- [ ] å€™è¡¥åˆ—è¡¨ï¼šæ˜¾ç¤ºæ‰€æœ‰å€™è¡¥è®°å½•
- [ ] å–æ¶ˆå€™è¡¥ï¼šå€™è¡¥çŠ¶æ€å˜ä¸º 'cancelled'
- [ ] åˆ—è¡¨åˆ·æ–°ï¼š`onShow()` é’©å­æ­£å¸¸è§¦å‘
- [ ] Store æ¸…ç©ºï¼šé¢„çº¦æˆ–å€™è¡¥æˆåŠŸå Store æ•°æ®æ¸…ç©º

### åç«¯ API é›†æˆæµ‹è¯•ï¼ˆUSE_MOCK=falseï¼‰
- [ ] åˆ›å»ºå€™è¡¥APIè°ƒç”¨æ­£å¸¸
- [ ] è·å–å€™è¡¥åˆ—è¡¨èƒ½è¿”å›æœ€æ–°çŠ¶æ€
- [ ] å–æ¶ˆå€™è¡¥èƒ½æ­£ç¡®å¤„ç†
- [ ] åç«¯è½¬é¢„çº¦åï¼Œå‰ç«¯èƒ½æ˜¾ç¤º status='success'
- [ ] appointments.vue èƒ½æ˜¾ç¤ºè½¬é¢„çº¦åçš„æ–°é¢„çº¦
- [ ] sourceType='waitlist' æ ‡ç­¾æ­£å¸¸æ˜¾ç¤º

---

## ğŸ“Š å‰ç«¯æ•°æ®æµæ€»ç»“

```
                Mockæ¨¡å¼                          çœŸå®APIæ¨¡å¼
                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å€™è¡¥åˆ›å»º         Mockä¿å­˜åˆ°mockWaitlist    POST /patient/waitlist
                â†“ è¿”å›mockWaitlistä¸­çš„æ•°æ®

å€™è¡¥åˆ—è¡¨æŸ¥è¯¢     Mix(æœ¬åœ°å­˜å‚¨+Mock)         GET /patient/waitlist
                â†“ åˆå¹¶å¹¶è¿”å›               â†“ è¿”å›æœ€æ–°çš„æœåŠ¡å™¨æ•°æ®

å€™è¡¥çŠ¶æ€å˜æ›´     Mockæ›´æ–°mockWaitlist      åç«¯å®šæ—¶ä»»åŠ¡æˆ–äº‹ä»¶æ›´æ–°
(å€™è¡¥æˆåŠŸ)       status='success'          status='success'
                â†“ å‰ç«¯åˆ·æ–°æ—¶è¯»å–           â†“ å‰ç«¯åˆ·æ–°æ—¶è¯»å–

é¢„çº¦åˆ—è¡¨æŸ¥è¯¢     Mix(æœ¬åœ°å­˜å‚¨+Mock)         GET /patient/appointments
                â†“ åŒ…æ‹¬æºè‡ªå€™è¡¥çš„é¢„çº¦        â†“ åŒ…æ‹¬ sourceType='waitlist'

é¡µé¢åˆ·æ–°         onShow() è‡ªåŠ¨åŠ è½½          onShow() è‡ªåŠ¨åŠ è½½æœ€æ–°APIæ•°æ®
                æœ€æ–°æ•°æ®
```

---

## ğŸš€ åç«¯é›†æˆæ£€æŸ¥æ¸…å•

### åç«¯å®Œæˆä»¥ä¸‹åŠŸèƒ½å
- [ ] API: POST /patient/waitlist åˆ›å»ºå€™è¡¥
- [ ] API: GET /patient/waitlist è·å–åˆ—è¡¨
- [ ] API: DELETE /patient/waitlist/{id} å–æ¶ˆå€™è¡¥
- [ ] API: DELETE /patient/appointments/{id} å–æ¶ˆé¢„çº¦ + è§¦å‘è½¬æ¢
- [ ] API: GET /patient/appointments è¿”å› sourceType å’Œ sourceWaitlistId
- [ ] å®šæ—¶ä»»åŠ¡ï¼šæ£€æŸ¥è¿‡æœŸå€™è¡¥
- [ ] å®šæ—¶ä»»åŠ¡ï¼šè‡ªåŠ¨è½¬æ¢å€™è¡¥ä¸ºé¢„çº¦

### å‰ç«¯éœ€è¦åš
- [ ] ä¿®æ”¹ `src/api/request.js` ä¸­çš„ `USE_MOCK = false`
- [ ] ä¿®æ”¹ `BASE_URL` æŒ‡å‘åç«¯ API
- [ ] æµ‹è¯•æ‰€æœ‰æµç¨‹
- [ ] éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

---

## ğŸ“š ç›¸å…³æ–‡ä»¶é€ŸæŸ¥è¡¨

| æ–‡ä»¶ | ä¸»è¦åŠŸèƒ½ | å€™è¡¥ç›¸å…³ä»£ç  |
|------|--------|-----------|
| `select-doctor.vue` | åŒ»ç”Ÿé€‰æ‹© | `joinWaitlist()` |
| `confirm-waitlist.vue` | å€™è¡¥ç¡®è®¤ | `confirmWaitlist()` |
| `waitlist-success.vue` | å€™è¡¥è¯¦æƒ… | `status` æ˜¾ç¤º |
| `waitlist.vue` | å€™è¡¥åˆ—è¡¨ | `loadWaitlist()`, `onShow()` |
| `appointments.vue` | é¢„çº¦åˆ—è¡¨ | `sourceType` æ˜¾ç¤º |
| `appointment.js` | APIæ¥å£ | æ‰€æœ‰å€™è¡¥ API |
| `appointment.js` (store) | çŠ¶æ€ç®¡ç† | `clearAppointmentData()` |

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: å€™è¡¥æˆåŠŸåä¸ºä»€ä¹ˆçœ‹ä¸åˆ°æ–°é¢„çº¦ï¼Ÿ
A: åŸå› å¯èƒ½ï¼š
1. âœ… åç«¯è¿˜æœªå®ç°è‡ªåŠ¨è½¬é¢„çº¦é€»è¾‘
2. âœ… éœ€è¦åˆ·æ–°"æˆ‘çš„é¢„çº¦"é¡µé¢ï¼ˆonShow è‡ªåŠ¨è§¦å‘ï¼‰
3. âœ… æ£€æŸ¥åç«¯æ˜¯å¦è¿”å›äº† sourceType å­—æ®µ

### Q: ä¸ºä»€ä¹ˆå€™è¡¥åˆ—è¡¨ä¸æ˜¾ç¤ºæœ€æ–°çŠ¶æ€ï¼Ÿ
A: 
1. âœ… ç¡®ä¿ onShow() é’©å­è¢«æ­£ç¡®è§¦å‘
2. âœ… æ£€æŸ¥ getMyWaitlist() æ˜¯å¦è¿”å›äº†æœ€æ–°çš„ status
3. âœ… å°è¯•æ‰‹åŠ¨åˆ·æ–°é¡µé¢æˆ–ä¸‹æ‹‰åˆ·æ–°

### Q: å¦‚ä½•æµ‹è¯•å€™è¡¥è½¬é¢„çº¦åŠŸèƒ½ï¼Ÿ
A:
1. âœ… åœ¨ Mock æ¨¡å¼ä¸‹ï¼Œæ‰‹åŠ¨ä¿®æ”¹ mockWaitlist ä¸­çš„ status
2. âœ… åœ¨çœŸå® API æ¨¡å¼ä¸‹ï¼Œåç«¯åˆ›å»ºè½¬é¢„çº¦çš„é€»è¾‘ï¼Œå‰ç«¯åˆ·æ–°æŸ¥çœ‹

### Q: Store çš„ clearAppointmentData() ä½•æ—¶è°ƒç”¨ï¼Ÿ
A:
1. âœ… å€™è¡¥æˆåŠŸåï¼šconfirm-waitlist.vue
2. âœ… é¢„çº¦æˆåŠŸåï¼šconfirm.vue
3. âœ… æ”¯ä»˜æˆåŠŸåï¼šsuccess.vue

---

## ğŸ“ åç«¯æ¥å£è”ç³»ä¿¡æ¯

**æ‰€æœ‰å€™è¡¥ç›¸å…³çš„åç«¯å¼€å‘ï¼Œè¯·å‚è€ƒæœ¬æ–‡ä»¶å¤¹ä¸­çš„ï¼š**
`å€™è¡¥è½¬é¢„çº¦åŠŸèƒ½-åç«¯å®ç°æŒ‡å—.md`

è¯¥æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†ï¼š
- âœ… æ‰€éœ€çš„æ•°æ®åº“è¡¨ç»“æ„
- âœ… è¯¦ç»†çš„ API æ¥å£å®šä¹‰
- âœ… æ ¸å¿ƒçš„è½¬é¢„çº¦é€»è¾‘å®ç°
- âœ… å®šæ—¶ä»»åŠ¡è®¾è®¡
- âœ… æµ‹è¯•ç”¨ä¾‹

