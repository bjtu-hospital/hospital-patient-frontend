# å€™è¡¥åŠŸèƒ½ - APIæ¥å£æ–‡æ¡£

> **æ¨¡å—**: å€™è¡¥åŠŸèƒ½  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-22  
> **æ¥å£è§„èŒƒ**: ç»Ÿä¸€è¿”å›æ ¼å¼ `{ code: 0, message: {} }` æˆ– `{ code: é0, message: "é”™è¯¯ä¿¡æ¯" }`

---

## ğŸ“‹ æ¥å£åˆ—è¡¨

1. [åŠ å…¥å€™è¡¥](#1-åŠ å…¥å€™è¡¥)
2. [è·å–å€™è¡¥åˆ—è¡¨](#2-è·å–å€™è¡¥åˆ—è¡¨)
3. [å–æ¶ˆå€™è¡¥](#3-å–æ¶ˆå€™è¡¥)
4. [å€™è¡¥è½¬é¢„çº¦](#4-å€™è¡¥è½¬é¢„çº¦)

---

## ğŸ“– æ¥å£è¯¦æƒ…

### 1. åŠ å…¥å€™è¡¥

å½“ç›®æ ‡æ—¶æ®µå·²çº¦æ»¡æ—¶ï¼Œç”¨æˆ·å¯ä»¥åŠ å…¥å€™è¡¥é˜Ÿåˆ—ï¼Œç­‰å¾…æœ‰äººå–æ¶ˆé¢„çº¦æ—¶è‡ªåŠ¨è½¬ä¸ºæ­£å¼é¢„çº¦ã€‚

- **æ¥å£åœ°å€**: `POST /patient/waitlist`
- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ˜¯å¦éœ€è¦ç™»å½•**: æ˜¯

**è¯·æ±‚å‚æ•°**:
```json
{
  "scheduleId": "schedule_001",
  "hospitalId": "hospital_001",
  "hospitalName": "åŒ—äº¬äº¤é€šå¤§å­¦åŒ»é™¢",
  "departmentId": "dept_005",
  "departmentName": "å†…ç§‘é—¨è¯Š",
  "doctorId": "doctor_001",
  "doctorName": "æåŒ»ç”Ÿ",
  "doctorTitle": "ä¸»ä»»åŒ»å¸ˆ",
  "appointmentDate": "2025-11-22",
  "appointmentTime": "ä¸Šåˆ 08:00-12:00",
  "price": 50,
  "patientId": "patient_001",
  "patientName": "å¼ ä¸‰"
}
```

**å‚æ•°è¯´æ˜**:
- `scheduleId` (string, required): æ’ç­ID
- `hospitalId` (string, required): åŒ»é™¢ID
- `hospitalName` (string, required): åŒ»é™¢åç§°
- `departmentId` (string, required): ç§‘å®¤ID
- `departmentName` (string, required): ç§‘å®¤åç§°
- `doctorId` (string, required): åŒ»ç”ŸID
- `doctorName` (string, required): åŒ»ç”Ÿå§“å
- `doctorTitle` (string, optional): åŒ»ç”ŸèŒç§°
- `appointmentDate` (string, required): æœŸæœ›å°±è¯Šæ—¥æœŸ
- `appointmentTime` (string, required): æœŸæœ›å°±è¯Šæ—¶é—´æ®µ
- `price` (number, required): æŒ‚å·è´¹
- `patientId` (string, required): å°±è¯ŠäººID
- `patientName` (string, required): å°±è¯Šäººå§“å

**è¿”å›æ•°æ®**:
```json
{
  "code": 0,
  "message": {
    "id": "waitlist_001",
    "queueNumber": 3,
    "estimatedTime": "2å°æ—¶",
    "createdAt": "2025-11-22T10:30:00Z"
  }
}
```

**å­—æ®µè¯´æ˜**:
- `id`: å€™è¡¥è®°å½•ID
- `queueNumber`: å½“å‰æ’é˜Ÿä½ç½®
- `estimatedTime`: é¢„è®¡ç­‰å¾…æ—¶é—´ï¼ˆä»…ä¾›å‚è€ƒï¼‰
- `createdAt`: åŠ å…¥å€™è¡¥çš„æ—¶é—´

---

### 2. è·å–å€™è¡¥åˆ—è¡¨

è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰å€™è¡¥è®°å½•ã€‚

- **æ¥å£åœ°å€**: `GET /patient/waitlist`
- **è¯·æ±‚æ–¹å¼**: `GET`
- **æ˜¯å¦éœ€è¦ç™»å½•**: æ˜¯

**è¯·æ±‚å‚æ•°**: æ— 

**è¿”å›æ•°æ®**:
```json
{
  "code": 0,
  "message": [
    {
      "id": "waitlist_001",
      "scheduleId": "schedule_001",
      "hospitalName": "åŒ—äº¬äº¤é€šå¤§å­¦åŒ»é™¢",
      "departmentName": "å†…ç§‘é—¨è¯Š",
      "doctorName": "æåŒ»ç”Ÿ",
      "doctorTitle": "ä¸»ä»»åŒ»å¸ˆ",
      "appointmentDate": "2025-11-22",
      "appointmentTime": "ä¸Šåˆ 08:00-12:00",
      "price": 50,
      "status": "waiting",
      "queueNumber": 3,
      "patientName": "å¼ ä¸‰",
      "createdAt": "2025-11-22T10:30:00Z"
    }
  ]
}
```

**å­—æ®µè¯´æ˜**:
- `status`: å€™è¡¥çŠ¶æ€
  - `waiting`: ç­‰å¾…ä¸­
  - `available`: å·²æœ‰å·æºï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
  - `converted`: å·²è½¬ä¸ºæ­£å¼é¢„çº¦
  - `expired`: å·²è¿‡æœŸ
  - `cancelled`: å·²å–æ¶ˆ

---

### 3. å–æ¶ˆå€™è¡¥

ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆå€™è¡¥æ’é˜Ÿã€‚

- **æ¥å£åœ°å€**: `DELETE /patient/waitlist/{waitlistId}`
- **è¯·æ±‚æ–¹å¼**: `DELETE`
- **æ˜¯å¦éœ€è¦ç™»å½•**: æ˜¯

**è·¯å¾„å‚æ•°**:
- `waitlistId` (string, required): å€™è¡¥è®°å½•ID

**è¯·æ±‚å‚æ•°**: æ— 

**è¿”å›æ•°æ®**:
```json
{
  "code": 0,
  "message": {
    "success": true
  }
}
```

---

### 4. å€™è¡¥è½¬é¢„çº¦

å½“æœ‰å·æºé‡Šæ”¾æ—¶ï¼Œç³»ç»Ÿé€šçŸ¥å€™è¡¥ç”¨æˆ·ï¼Œç”¨æˆ·éœ€è¦åœ¨é™å®šæ—¶é—´å†…ç¡®è®¤è½¬ä¸ºæ­£å¼é¢„çº¦ã€‚

- **æ¥å£åœ°å€**: `POST /patient/waitlist/{waitlistId}/convert`
- **è¯·æ±‚æ–¹å¼**: `POST`
- **æ˜¯å¦éœ€è¦ç™»å½•**: æ˜¯

**è·¯å¾„å‚æ•°**:
- `waitlistId` (string, required): å€™è¡¥è®°å½•ID

**è¯·æ±‚å‚æ•°**:
```json
{
  "slotId": "schedule_001_slot_001"
}
```

**å‚æ•°è¯´æ˜**:
- `slotId` (string, optional): å…·ä½“æ—¶æ®µIDï¼ˆå¦‚æœæœ‰ï¼‰

**è¿”å›æ•°æ®**:
```json
{
  "code": 0,
  "message": {
    "id": "appointment_002",
    "appointmentDate": "2025-11-22",
    "appointmentTime": "ä¸Šåˆ 08:00-12:00",
    "queueNumber": 8,
    "doctorName": "æåŒ»ç”Ÿ",
    "price": 50,
    "status": "unpaid",
    "createdAt": "2025-11-22T12:00:00Z",
    "expiresAt": "2025-11-22T12:30:00Z"
  }
}
```

**å­—æ®µè¯´æ˜**:
- `status`: é¢„çº¦çŠ¶æ€ï¼ˆè½¬æ¢åä¸º `unpaid`ï¼Œéœ€æ”¯ä»˜ï¼‰
- `expiresAt`: æ”¯ä»˜è¶…æ—¶æ—¶é—´ï¼ˆ30åˆ†é’Ÿåï¼‰

---

## ğŸ“Œ å€™è¡¥è§„åˆ™

### 1. åŠ å…¥æ¡ä»¶
- âœ… ç›®æ ‡æ—¶æ®µå·æºå·²æ»¡
- âœ… ç”¨æˆ·å·²ç™»å½•
- âœ… å·²é€‰æ‹©å°±è¯Šäºº
- âŒ åŒä¸€æ’ç­ä¸èƒ½é‡å¤å€™è¡¥

### 2. æ’é˜Ÿæœºåˆ¶
- æŒ‰ç…§åŠ å…¥å€™è¡¥çš„æ—¶é—´å…ˆåæ’é˜Ÿ
- é˜Ÿåˆ—ä½ç½®å®æ—¶æ›´æ–°
- æ˜¾ç¤ºå½“å‰æ’é˜Ÿä½ç½®å’Œé¢„è®¡ç­‰å¾…æ—¶é—´

### 3. é€šçŸ¥æœºåˆ¶
å½“æœ‰å·æºé‡Šæ”¾æ—¶ï¼š
1. ç³»ç»Ÿè‡ªåŠ¨é€šçŸ¥é˜Ÿåˆ—ç¬¬ä¸€ä½ç”¨æˆ·
2. ç”¨æˆ·æ”¶åˆ°ç«™å†…æ¶ˆæ¯
3. å€™è¡¥çŠ¶æ€å˜æ›´ä¸º `available`
4. ç”¨æˆ·éœ€è¦åœ¨**10åˆ†é’Ÿå†…**ç¡®è®¤æ˜¯å¦è½¬ä¸ºé¢„çº¦

### 4. ç¡®è®¤è¶…æ—¶
å¦‚æœç”¨æˆ·åœ¨10åˆ†é’Ÿå†…æœªç¡®è®¤ï¼š
- è¯¥å€™è¡¥è®°å½•çŠ¶æ€å˜æ›´ä¸º `expired`
- å·æºè‡ªåŠ¨é‡Šæ”¾ç»™é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä½ç”¨æˆ·
- åç»­å€™è¡¥æ’é˜Ÿä½ç½®è‡ªåŠ¨å‰ç§»

### 5. è½¬é¢„çº¦è§„åˆ™
ç”¨æˆ·ç¡®è®¤è½¬ä¸ºé¢„çº¦åï¼š
- å€™è¡¥è®°å½•çŠ¶æ€å˜æ›´ä¸º `converted`
- ç”Ÿæˆæ­£å¼é¢„çº¦è®°å½•ï¼ŒçŠ¶æ€ä¸º `unpaid`
- éœ€è¦åœ¨**30åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜**
- æ”¯ä»˜è¶…æ—¶åˆ™é¢„çº¦è‡ªåŠ¨å–æ¶ˆï¼Œå·æºé‡æ–°é‡Šæ”¾

### 6. å€™è¡¥è¿‡æœŸ
å€™è¡¥è®°å½•åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è¿‡æœŸï¼š
- å°±è¯Šæ—¥æœŸå·²è¿‡
- åŒ»ç”Ÿå–æ¶ˆæ’ç­
- ç”¨æˆ·å–æ¶ˆå€™è¡¥

---

## ğŸ“Š å€™è¡¥æµç¨‹

```
ç”¨æˆ·é€‰æ‹©å·²çº¦æ»¡çš„æ—¶æ®µ
    â†“
ç‚¹å‡»"åŠ å…¥å€™è¡¥"
    â†“
å¡«å†™å€™è¡¥ä¿¡æ¯ï¼ˆå°±è¯Šäººç­‰ï¼‰
    â†“
æäº¤å€™è¡¥è¯·æ±‚
    â†“
åŠ å…¥å€™è¡¥é˜Ÿåˆ—ï¼ˆwaitingï¼‰
    â†“
ç­‰å¾…å·æºé‡Šæ”¾...
    â†“
ã€æœ‰å·æºé‡Šæ”¾ã€‘
    â†“
ç³»ç»Ÿé€šçŸ¥ç¬¬ä¸€ä½å€™è¡¥ç”¨æˆ·ï¼ˆavailableï¼‰
    â†“
ç”¨æˆ·10åˆ†é’Ÿå†…ç¡®è®¤è½¬é¢„çº¦
    â†“
  â”œâ”€ ç¡®è®¤ï¼šç”Ÿæˆé¢„çº¦è®°å½•ï¼ˆunpaidï¼‰â†’ 30åˆ†é’Ÿå†…æ”¯ä»˜
  â””â”€ è¶…æ—¶ï¼šå€™è¡¥è¿‡æœŸï¼ˆexpiredï¼‰â†’ é€šçŸ¥ä¸‹ä¸€ä½
```

---

## âš ï¸ é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|--------|------|----------|
| 0 | æˆåŠŸ | - |
| 400 | å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•° |
| 401 | æœªç™»å½•æˆ–tokenè¿‡æœŸ | è·³è½¬åˆ°ç™»å½•é¡µ |
| 1005 | è¯¥æ—¶æ®µæœ‰å·æºï¼Œæ— éœ€å€™è¡¥ | æç¤ºç›´æ¥é¢„çº¦ |
| 1006 | å·²åœ¨å€™è¡¥é˜Ÿåˆ—ä¸­ | æç¤ºä¸èƒ½é‡å¤å€™è¡¥ |
| 1007 | å€™è¡¥ç¡®è®¤è¶…æ—¶ | æç¤ºå€™è¡¥å·²è¿‡æœŸ |
| 1008 | å€™è¡¥è½¬é¢„çº¦å¤±è´¥ | æç¤ºå·æºå·²è¢«å ç”¨ |

---

## ğŸ“ è°ƒç”¨ç¤ºä¾‹

```javascript
import { 
  joinWaitlist, 
  getWaitlist, 
  cancelWaitlist, 
  convertWaitlistToAppointment 
} from '@/api/appointment'

// 1. åŠ å…¥å€™è¡¥
const result = await joinWaitlist({
  scheduleId: 'schedule_001',
  hospitalId: 'hospital_001',
  hospitalName: 'åŒ—äº¬äº¤é€šå¤§å­¦åŒ»é™¢',
  departmentId: 'dept_005',
  departmentName: 'å†…ç§‘é—¨è¯Š',
  doctorId: 'doctor_001',
  doctorName: 'æåŒ»ç”Ÿ',
  appointmentDate: '2025-11-22',
  appointmentTime: 'ä¸Šåˆ 08:00-12:00',
  price: 50,
  patientId: 'patient_001',
  patientName: 'å¼ ä¸‰'
})
// æˆåŠŸï¼šresult = {id: '...', queueNumber: 3, estimatedTime: '2å°æ—¶'}

// 2. è·å–å€™è¡¥åˆ—è¡¨
const waitlistItems = await getWaitlist()
// æˆåŠŸï¼šwaitlistItems = [{id: '...', status: 'waiting', ...}, ...]

// 3. å–æ¶ˆå€™è¡¥
await cancelWaitlist('waitlist_001')
// æˆåŠŸï¼š{success: true}

// 4. å€™è¡¥è½¬é¢„çº¦
const appointment = await convertWaitlistToAppointment('waitlist_001', {
  slotId: 'schedule_001_slot_001'
})
// æˆåŠŸï¼šappointment = {id: '...', status: 'unpaid', expiresAt: '...'}
```

---

## ğŸ”„ å‰ç«¯å®ç°è¦ç‚¹

### 1. æ•°æ®æµ
```
select-doctor.vue (é€‰æ‹©åŒ»ç”Ÿï¼Œæ—¶æ®µå·²æ»¡)
    â†“ ç‚¹å‡»"åŠ å…¥å€™è¡¥"
confirm-waitlist.vue (ç¡®è®¤å€™è¡¥ä¿¡æ¯)
    â†“ joinWaitlist()
waitlist-success.vue (å€™è¡¥æˆåŠŸé¡µ)
    â†“
profile/waitlist.vue (å€™è¡¥åˆ—è¡¨)
    â†“ æ”¶åˆ°é€šçŸ¥ï¼šstatus = available
    â†“ convertWaitlistToAppointment()
appointment/payment.vue (æ”¯ä»˜é¡µ)
```

### 2. Storeç®¡ç†
```javascript
// å­˜å‚¨å€™è¡¥ä¸Šä¸‹æ–‡
appointmentStore.setWaitlistContext({
  scheduleId,
  hospitalId,
  doctorId,
  // ... å…¶ä»–ä¿¡æ¯
})

// æ¸…é™¤å€™è¡¥æ•°æ®
appointmentStore.clearWaitlistData()
```

### 3. æ¶ˆæ¯é€šçŸ¥
- å½“å€™è¡¥çŠ¶æ€å˜ä¸º `available` æ—¶ï¼Œå‰ç«¯éœ€è¦ï¼š
  - æ˜¾ç¤ºç«™å†…æ¶ˆæ¯æé†’
  - æç¤ºç”¨æˆ·"æ‚¨çš„å€™è¡¥å·²æœ‰å·æºï¼Œè¯·å°½å¿«ç¡®è®¤"
  - æ˜¾ç¤º10åˆ†é’Ÿå€’è®¡æ—¶
  - æä¾›"ç«‹å³ç¡®è®¤"å’Œ"å–æ¶ˆå€™è¡¥"æŒ‰é’®

### 4. çŠ¶æ€è½®è¯¢
å»ºè®®åœ¨å€™è¡¥åˆ—è¡¨é¡µé¢ï¼š
- å®šæ—¶è½®è¯¢å€™è¡¥çŠ¶æ€ï¼ˆæ¯30ç§’ï¼‰
- å®æ—¶æ›´æ–°æ’é˜Ÿä½ç½®
- åŠæ—¶å‘ç° `available` çŠ¶æ€å˜åŒ–

---

**æ–‡æ¡£ç»´æŠ¤**: å‰ç«¯å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-11-22
